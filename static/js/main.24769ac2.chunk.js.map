{"version":3,"sources":["cage.js","arrow.js","path.js","symbols.js","draw.js","App.js","serviceWorker.js","index.js"],"names":["DrawCage","ctx","cells","_style","color","split","style","size","width","getLineWidth","_size","corner_offset","cell_size","cs","get_cage","x","y","find","e","DrawColorPremul","corner_pos","corner_ext_pos","lines","each_cell","m","up","down","left","right","ul","ur","dl","dr","l","add_line","start","end","push","Line","points","dash","strokeWidth","stroke","slice","length","cont","add","concat","drawDashCage","corner","lineCap","ocont","drawEdgeCage","Arrow","config","arrowLength","context","this","beginPath","moveTo","n","lineTo","p0x","p0y","dx","dy","Math","sqrt","a","atan2","a1","PI","a2","al","cos","sin","strokeShape","Thermo","arc","center","p","DrawPath","radius","DrawColors","start_px","map","px","objs","roundLine","flat","lineJoin","squareLine","newLine","thermo","line","closed","fill","w","line1","line2","arrow","bulb","Circle","underlay2","scene","draw","DrawSymbol","container","str","_color","bg","cx","cy","page","substr","symbol","text","destroy","symboltext","min","sym","obj","meas","Text","fontSize","listening","measureSize","position","height","copt","offset","offset2","aopt","pointerLength","pointerWidth","Star","innerRadius","outerRadius","numPoints","o","Group","Rect","rect","bgrect","c","symbolcolor","symbolbg","grid_w","grid_h","main_w","main_h","grid_left","grid_top","grid_bottom","grid_right","grid_div_width","grid_div_height","grid_style","grid_left_diagonal","grid_right_diagonal","hover_offset","symbol_page","multi_digit","number_bg","cursor_visible","sol_text_color","Util","colorToRGBA","r","g","b","current_color","current_mode","current_rmode","current_style","solve_mode","matrix","stuff","edges","drag","drag_toggle","drag_button","undo_stack","redo_stack","current","outer","underlay","shift","cursor","boundary","grid_lines","RectHolder","undefined","TextHolder","_text","t","setSymbol","normal","symcont","bsize","DrawSymbolElement","element","num","stage","Stage","layer","Layer","saveState","state","s","r_color","cross","edge","centerline","edgecross","forEach","i","lock","saveUndo","loadState","get","setCell","drawCross","drawEdge","drawEdgeCross","drawCenterLine","_setCell","pos","mode","newtext","main_grid","lock_type","bindex","r_color_set","console","log","indexOf","lock_cell","DrawSetNumber","number","count","each_mark","DrawSetColor","color_index","mark","fillEnabled","last_toggle_state","set","eo","new_edge","x1","y1","btype2","edgeToggle","cp","bw","bwidth","bh","bheight","cline","centerLineToggle","last_toggle","last_move","unmark","boundary_mousedown","event","mark_boundary","mousedown","evt","stopPropagation","type","button","hasCross","hasEdgeCross","mouseup","last","DrawSetMode","numberBackground","multiDigit","cageStyle","pathStyle","edgeStyle","numberStyle","btype","on","edgeMousemove","edgeMouseup","setBoundary","f","load_grid","base64","pack","Uint8Array","from","atob","charCodeAt","unpack","pako","inflate","data","msgpack","decode","version","alert","unserialize_grid","grid","unserialize","k","_s","serialize","meta","out","desc","DrawDelete","findLastIndex","splice","DrawUndo","pop","DrawRedo","render","wrapper","margin","stage_w","stage_h","gridlayer","overlay","xp","yp","r_inner","corner_size","co","bc","addBoundary","type2","h","Array","isArray","textcont","qsize","qc","ew","eh","bsize2","addBoundaries","mousemove","inner_mousemove","dots","thin","fat","diagonal","dsize","addGrid","DrawRender","code","solveMode","cellSize","top","bottom","gridDivWidth","gridDivHeight","gridStyle","gridLeftDiagonal","gridRightDiagonal","load","window","addEventListener","target","tagName","key","preventDefault","includes","startsWith","keydown","keyup","window_mousedown","contextmenu","query","location","search","urlParams","URLSearchParams","ColorGrid","props","index","Grid","item","xs","Button","variant","onClick","border","background","Timer","useState","seconds","setSeconds","useEffect","id","setInterval","active","clearInterval","Box","padding","boxShadow","Typography","align","Date","toISOString","ButtonGroup","fullWidth","onStart","PlayArrow","onStop","Pause","SkipPrevious","ResetButton","confirm","useConfirm","description","then","setState","timeStatus","catch","SymbolSelect","setPage","symbolRef","useRef","DrawSetSymbolPage","FormControl","Select","value","onChange","MenuItem","keys","ref","ColorSelect","setColor","UrlDialog","Dialog","open","onClose","DialogTitle","DialogContent","DialogContentText","DialogActions","focus","App","handleKeyDown","cycle_modes","setMode","document","getElementById","setStyle","generateUrl","url","coded","encode","packed","deflate","btoa","String","fromCharCode","origin","encodeURIComponent","DrawGenerateUrl","solveSudoku","solveEdge","solveCenterLine","dialogText","dialogOpen","setGridState","setGrid","check","range","rows","columns","boxes","missing","floor","isEqual","sort","DrawCheck","status","msg","canvasRef","React","createRef","settingsMode","symbolPage","DrawGetMetaData","removeEventListener","interval","InputLabel","shrink","labelId","FormControlLabel","control","Switch","checked","label","minWidth","TextField","multiline","InputProps","readOnly","numberStyleBox","cageStyleBox","pathStyleBox","edgeStyleBox","sizeSlider","FormLabel","FormGroup","newValue","DrawUpdateGrid","max","step","marks","Slider","handleChange","onChangeCommitted","buttons","display","flexDirection","timerBox","maxWidth","orientation","settingLeftBox","settingRight","renderSolveMode","renderSetMode","Component","Boolean","hostname","match","ReactDOM","StrictMode","navigator","serviceWorker","ready","registration","unregister","error","message"],"mappings":"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","file":"static/js/main.24769ac2.chunk.js","sourcesContent":["import { Line } from \"konva\";\r\nimport { DrawColorPremul } from \"./draw\";\r\n\r\nexport function DrawCage(ctx, cells, _style, color) {\r\n  let [style, size] = _style.split(\":\");\r\n  let width = ctx.getLineWidth(size);\r\n  if (style === \"dash\") return drawDashCage(ctx, cells, width, color);\r\n  if (style === \"edge\") return drawEdgeCage(ctx, cells, width, color);\r\n}\r\n\r\nfunction drawDashCage(ctx, cells, _size, color) {\r\n  let size = 2; //ctx.cell_size / 32;\r\n  let corner_offset = ctx.cell_size * 0.08;\r\n  let cs = ctx.cell_size;\r\n  let get_cage = (x, y) => {\r\n    return cells.find((e) => e[0] === x && e[1] === y);\r\n  };\r\n  color = DrawColorPremul(color);\r\n\r\n  const corner_pos = [\r\n    [corner_offset, corner_offset],\r\n    [cs - corner_offset, corner_offset],\r\n    [cs - corner_offset, cs - corner_offset],\r\n    [corner_offset, cs - corner_offset],\r\n  ];\r\n\r\n  const corner_ext_pos = [\r\n    [0, corner_offset],\r\n    [corner_offset, 0],\r\n    [cs - corner_offset, 0],\r\n    [cs, corner_offset],\r\n    [cs, cs - corner_offset],\r\n    [cs - corner_offset, cs],\r\n    [corner_offset, cs],\r\n    [0, cs - corner_offset],\r\n  ];\r\n\r\n  let lines = [];\r\n  ctx.each_cell((m) => {\r\n    let x = m.x;\r\n    let y = m.y;\r\n    if (!get_cage(x, y)) return;\r\n    let up = get_cage(x, y - 1);\r\n    let down = get_cage(x, y + 1);\r\n    let left = get_cage(x - 1, y);\r\n    let right = get_cage(x + 1, y);\r\n    let ul = get_cage(x - 1, y - 1);\r\n    let ur = get_cage(x + 1, y - 1);\r\n    let dl = get_cage(x - 1, y + 1);\r\n    let dr = get_cage(x + 1, y + 1);\r\n    let l = [];\r\n    let add_line = (start, end) => {\r\n      l.push(\r\n        new Line({\r\n          points: [...start, ...end],\r\n          dash: [ctx.cell_size / 20],\r\n          strokeWidth: size,\r\n          stroke: color,\r\n        })\r\n      );\r\n    };\r\n    if (!left) {\r\n      let start = corner_pos[0];\r\n      let end = corner_pos[3];\r\n      if (up) {\r\n        start = corner_ext_pos[1].slice(0);\r\n        start[1] -= !ul ? 0 : corner_offset;\r\n      }\r\n      if (down) {\r\n        end = corner_ext_pos[6].slice(0);\r\n        end[1] += !dl ? 0 : corner_offset;\r\n      }\r\n      add_line(start, end);\r\n    }\r\n    if (!right) {\r\n      let start = corner_pos[1];\r\n      let end = corner_pos[2];\r\n      if (up) {\r\n        start = corner_ext_pos[2].slice(0);\r\n        start[1] -= !ur ? 0 : corner_offset;\r\n      }\r\n      if (down) {\r\n        end = corner_ext_pos[5].slice(0);\r\n        end[1] += !dr ? 0 : corner_offset;\r\n      }\r\n      add_line(start, end);\r\n    }\r\n    if (!up) {\r\n      let start = corner_pos[0];\r\n      let end = corner_pos[1];\r\n      if (left) {\r\n        start = corner_ext_pos[0].slice(0);\r\n        start[0] -= !ul ? 0 : corner_offset;\r\n      }\r\n      if (right) {\r\n        end = corner_ext_pos[3].slice(0);\r\n        end[0] += !ur ? 0 : corner_offset;\r\n      }\r\n      add_line(start, end);\r\n    }\r\n    if (!down) {\r\n      let start = corner_pos[3];\r\n      let end = corner_pos[2];\r\n      if (left) {\r\n        start = corner_ext_pos[7].slice(0);\r\n        start[0] -= !dl ? 0 : corner_offset;\r\n      }\r\n      if (right) {\r\n        end = corner_ext_pos[4].slice(0);\r\n        end[0] += !dr ? 0 : corner_offset;\r\n      }\r\n      add_line(start, end);\r\n    }\r\n    if (l.length > 0) m.cont.add(...l);\r\n    lines = lines.concat(l);\r\n  });\r\n  return lines;\r\n}\r\n\r\nfunction drawEdgeCage(ctx, cells, size, color) {\r\n  let cs = ctx.cell_size;\r\n  let get_cage = (x, y) => {\r\n    return cells.find((e) => e[0] === x && e[1] === y);\r\n  };\r\n  color = DrawColorPremul(color);\r\n\r\n  const corner = [\r\n    [0, 0],\r\n    [cs, 0],\r\n    [cs, cs],\r\n    [0, cs],\r\n  ];\r\n\r\n  let lines = [];\r\n  ctx.each_cell((m) => {\r\n    let x = m.x;\r\n    let y = m.y;\r\n    if (!get_cage(x, y)) return;\r\n    let up = get_cage(x, y - 1);\r\n    let down = get_cage(x, y + 1);\r\n    let left = get_cage(x - 1, y);\r\n    let right = get_cage(x + 1, y);\r\n    let l = [];\r\n    let add_line = (start, end) => {\r\n      l.push(\r\n        new Line({\r\n          points: [...start, ...end],\r\n          strokeWidth: size,\r\n          stroke: color,\r\n          lineCap: \"round\",\r\n        })\r\n      );\r\n    };\r\n    if (!left) {\r\n      let start = corner[0];\r\n      let end = corner[3];\r\n      add_line(start, end);\r\n    }\r\n    if (!right) {\r\n      let start = corner[1];\r\n      let end = corner[2];\r\n      add_line(start, end);\r\n    }\r\n    if (!up) {\r\n      let start = corner[0];\r\n      let end = corner[1];\r\n      add_line(start, end);\r\n    }\r\n    if (!down) {\r\n      let start = corner[3];\r\n      let end = corner[2];\r\n      add_line(start, end);\r\n    }\r\n    if (l.length > 0) m.ocont.add(...l);\r\n    lines.push(...l);\r\n  });\r\n  return lines;\r\n}\r\n","import { Line } from \"konva\";\r\n\r\nexport default class Arrow extends Line {\r\n  constructor(config) {\r\n    super(config);\r\n    this.arrowLength = config.arrowLength;\r\n  }\r\n\r\n  _sceneFunc(context) {\r\n    let points = this.points();\r\n    let length = points.length;\r\n    context.beginPath();\r\n    context.moveTo(points[0], points[1]);\r\n    for (let n = 2; n < length; n += 2) {\r\n      context.lineTo(points[n], points[n + 1]);\r\n    }\r\n    let p0x = points[points.length - 2];\r\n    let p0y = points[points.length - 1];\r\n    let p1x = points[points.length - 4];\r\n    let p1y = points[points.length - 3];\r\n    let dx = p1x - p0x;\r\n    let dy = p1y - p0y;\r\n    let dl = Math.sqrt(dx ** 2 + dy ** 2);\r\n    if (dl > 0) {\r\n      let a = Math.atan2(dy, dx);\r\n      let a1 = a + Math.PI / 4;\r\n      let a2 = a - Math.PI / 4;\r\n      let al = this.arrowLength;\r\n      context.moveTo(p0x + al * Math.cos(a1), p0y + al * Math.sin(a1));\r\n      context.lineTo(p0x, p0y);\r\n      context.lineTo(p0x + al * Math.cos(a2), p0y + al * Math.sin(a2));\r\n    }\r\n    context.strokeShape(this);\r\n  }\r\n}\r\n","import { Circle, Line } from \"konva\";\r\nimport { DrawColors } from \"./draw\";\r\nimport Arrow from \"./arrow\";\r\n\r\nclass Thermo extends Line {\r\n  _sceneFunc(context) {\r\n    let points = this.points();\r\n    let length = points.length;\r\n    context.beginPath();\r\n    context.moveTo(points[0], points[1]);\r\n    context.arc(points[0], points[1], this.strokeWidth() * 0.8, 0, 2 * Math.PI, true);\r\n    context.moveTo(points[0], points[1]);\r\n    for (let n = 2; n < length; n += 2) {\r\n      context.lineTo(points[n], points[n + 1]);\r\n    }\r\n    context.strokeShape(this);\r\n  }\r\n}\r\n\r\nfunction center(cell_size, p) {\r\n  return [p[0] * cell_size + cell_size / 2, p[1] * cell_size + cell_size / 2];\r\n}\r\n\r\nexport function DrawPath(ctx, cells, style, color) {\r\n  let cell_size = ctx.cell_size;\r\n  let radius = ctx.radius * cell_size;\r\n  let strokeWidth = ctx.getLineWidth(\"medium\");\r\n\r\n  color = DrawColors[color];\r\n\r\n  let start_px = center(cell_size, cells[0]);\r\n  let points = cells.map((p) => {\r\n    let px = center(cell_size, p);\r\n    return [px[0], px[1]];\r\n  });\r\n  if (points.length === 1) points.push(points[points.length - 1]);\r\n  points = points.flat();\r\n  let objs = [];\r\n  let roundLine = {\r\n    points: points,\r\n    stroke: color,\r\n    lineCap: \"round\",\r\n    lineJoin: \"round\",\r\n  };\r\n  let squareLine = {\r\n    points: points,\r\n    stroke: color,\r\n    lineCap: \"square\",\r\n    lineJoin: \"miter\",\r\n  };\r\n  let newLine = (width) => new Line({\r\n    ...roundLine,\r\n    strokeWidth: width,\r\n  });\r\n\r\n  if (style === \"thermo\") {\r\n    let thermo = new Thermo({\r\n      ...roundLine,\r\n      strokeWidth: cell_size * 0.3,\r\n    });\r\n    objs.push(thermo);\r\n  } else if (style === \"polygon\") {\r\n    let line = new Line({\r\n      ...roundLine,\r\n      strokeWidth: strokeWidth,\r\n      stroke: color,\r\n      closed: true,\r\n    });\r\n    objs.push(line);\r\n  } else if (style === \"polygonfill\") {\r\n    let line = new Line({\r\n      ...roundLine,\r\n      strokeWidth: strokeWidth,\r\n      fill: color,\r\n      closed: true,\r\n    });\r\n    objs.push(line);\r\n  } else if (style === \"thin\") {\r\n    let line = newLine(ctx.getLineWidth(\"thin\"));\r\n    objs.push(line);\r\n  } else if (style === \"medium\") {\r\n    let line = newLine(ctx.getLineWidth(\"medium\"));\r\n    objs.push(line);\r\n  } else if (style === \"fat\") {\r\n    let line = newLine(ctx.getLineWidth(\"fat\"));\r\n    objs.push(line);\r\n  } else if (style === \"roundborder\") {\r\n    let w = cell_size * ctx.radius * 2 + ctx.getLineWidth(\"medium\");\r\n    let line1 = newLine(w);\r\n    let line2 = new Line({\r\n      ...roundLine,\r\n      strokeWidth: w - ctx.getLineWidth(\"medium\") * 2,\r\n      stroke: \"white\",\r\n    });\r\n    objs.push(line1, line2);\r\n  } else if (style === \"border\") {\r\n    // TODO only allow 90 degree angles\r\n    let line1 = new Line({\r\n      ...squareLine,\r\n      strokeWidth: cell_size * 0.8,\r\n    });\r\n    let line2 = new Line({\r\n      ...squareLine,\r\n      strokeWidth: cell_size * 0.67,\r\n      stroke: \"white\",\r\n    });\r\n    objs.push(line1, line2);\r\n  } else if (style === \"roundfill\") {\r\n    let line = newLine(cell_size * ctx.radius * 2);\r\n    objs.push(line);\r\n  } else if (style === \"squarefill\") {\r\n    let line = new Line({\r\n      ...squareLine,\r\n      strokeWidth: cell_size * 0.8,\r\n    });\r\n    objs.push(line);\r\n  } else if (style === \"arrowcircle\" || style === \"arrow\") {\r\n    let arrow = new Arrow({\r\n      points: points,\r\n      stroke: color,\r\n      strokeWidth: strokeWidth,\r\n      lineCap: \"butt\",\r\n      lineJoin: \"miter\",\r\n      arrowLength: cell_size * 0.3\r\n    });\r\n    objs.push(arrow);\r\n    if (style === \"arrowcircle\") {\r\n      let bulb = new Circle({\r\n        x: start_px[0],\r\n        y: start_px[1],\r\n        radius: radius,\r\n        fill: \"white\",\r\n        strokeWidth: strokeWidth,\r\n        stroke: color,\r\n      });\r\n      objs.push(bulb);\r\n    }\r\n  }\r\n\r\n  ctx.underlay2.add(...objs);\r\n  ctx.scene.draw();\r\n\r\n  return objs;\r\n}\r\n","//import Arrow from \"./arrow\";\r\nimport { Circle, Star, Rect, Group, Text, Line } from \"konva\";\r\nimport { DrawColorPremul } from \"./draw\";\r\n\r\nimport Arrow from \"./arrow\";\r\n\r\nexport function DrawSymbol(ctx, container, str, _color, _size, bg) {\r\n  let page = +str.substr(1, 1);\r\n  let symbol = +str.substr(2, 1);\r\n  let color = DrawColorPremul(_color);\r\n  let cx;\r\n  let cy;\r\n  let size;\r\n\r\n  if (str === \"\") {\r\n    if (container.text) {\r\n      container.text.text(str);\r\n    }\r\n    if (container.symbol) {\r\n      container.symbol.destroy();\r\n      container.symbol = null;\r\n      container.symboltext = \"\";\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (typeof _size === \"object\") {\r\n    cx = _size[0] / 2;\r\n    cy = _size[1] / 2;\r\n    size = Math.min(..._size);\r\n  } else {\r\n    size = _size;\r\n    cx = size / 2;\r\n    cy = size / 2;\r\n  }\r\n\r\n  let radius = ctx.radius * size;\r\n  let strokeWidth = ctx.getLineWidth(\"medium\", size);\r\n  let sym;\r\n\r\n  if (str[0] !== \"#\") page = 0;\r\n\r\n  if (page === 0) {\r\n    if (container.text) {\r\n      container.text.text(str);\r\n      container.text.obj.fill(color);\r\n      return;\r\n    }\r\n    else {\r\n      sym = new Text({\r\n        text: str,\r\n        fontSize: size,\r\n        fill: color,\r\n        listening: false,\r\n      });\r\n      let meas = sym.measureSize(str);\r\n      sym.position({\r\n        x: cx - meas.width / 2,\r\n        y: cy - meas.height / 2,\r\n      });\r\n    }\r\n  }\r\n  if (page === 1) {\r\n    let copt = {\r\n      x: cx,\r\n      y: cy,\r\n      radius: radius,\r\n      strokeWidth: strokeWidth,\r\n      listening: false,\r\n    };\r\n    if (symbol === 1) {\r\n      // circle fill\r\n      sym = new Circle({\r\n        ...copt,\r\n        fill: color,\r\n        stroke: \"black\",\r\n      });\r\n    }\r\n    if (symbol === 2) {\r\n      // circle outline\r\n      sym = new Circle({\r\n        ...copt,\r\n        fill: \"white\",\r\n        stroke: color,\r\n      });\r\n    }\r\n    if (symbol === 3) {\r\n      // dash circle fill\r\n      sym = new Circle({\r\n        ...copt,\r\n        fill: color,\r\n        stroke: \"black\",\r\n        dash: [4],\r\n      });\r\n    }\r\n    if (symbol === 4) {\r\n      // dash circle outline\r\n      sym = new Circle({\r\n        ...copt,\r\n        fill: \"white\",\r\n        stroke: color,\r\n        dash: [4],\r\n      });\r\n    }\r\n    if (symbol === 5) {\r\n      // dash circle outline\r\n      sym = new Circle({\r\n        ...copt,\r\n        fill: color,\r\n        strokeWidth: 0,\r\n      });\r\n    }\r\n  }\r\n  if (page === 2) {\r\n    // Little killer style arrows\r\n    let offset = size * 0.05;\r\n    let offset2 = size * 0.15;\r\n    let aopt = {\r\n      stroke: color,\r\n      strokeWidth: strokeWidth,\r\n      fill: color,\r\n      pointerLength: size * 0.3,\r\n      pointerWidth: size * 0.3,\r\n      arrowLength: size * 0.3,\r\n      listening: false\r\n    };\r\n    if (symbol === 1) {\r\n      sym = new Arrow({\r\n        x: cx,\r\n        y: cy,\r\n        points: [offset, offset, size - cx - offset, size - cy - offset],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 2) {\r\n      sym = new Arrow({\r\n        x: cx,\r\n        y: cy,\r\n        points: [0, 0, size - cx - offset, -cy + offset],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 3) {\r\n      sym = new Arrow({\r\n        x: cx,\r\n        y: cy,\r\n        points: [0, 0, -cx + offset, -cy + offset],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 4) {\r\n      sym = new Arrow({\r\n        x: cx,\r\n        y: cy,\r\n        points: [0, 0, -cx + offset, size - cy - offset],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 5) {\r\n      sym = new Arrow({\r\n        x: offset2,\r\n        y: cy,\r\n        points: [0, 0, size - offset2 * 2, 0],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 6) {\r\n      sym = new Arrow({\r\n        x: size - offset2,\r\n        y: cy,\r\n        points: [0, 0, -(size - offset2 * 2), 0],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 7) {\r\n      sym = new Arrow({\r\n        x: cx,\r\n        y: offset2,\r\n        points: [0, 0, 0, size - offset2 * 2],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 8) {\r\n      sym = new Arrow({\r\n        x: cx,\r\n        y: size - offset2,\r\n        points: [0, 0, 0, -(size - offset2 * 2)],\r\n        ...aopt,\r\n      });\r\n    }\r\n  }\r\n  if (page === 3) {\r\n    // Yajilin style arrows\r\n    let offset = size * 0.2;\r\n    let aopt = {\r\n      stroke: color,\r\n      fill: color,\r\n      strokeWidth: size * 0.03,\r\n      pointerLength: size * 0.1,\r\n      pointerWidth: size * 0.1,\r\n      arrowLength: size * 0.1,\r\n      listening: false,\r\n    };\r\n    if (symbol === 1) {\r\n      sym = new Arrow({\r\n        x: offset,\r\n        y: offset,\r\n        points: [0, 0, size - offset * 2, 0],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 2) {\r\n      sym = new Arrow({\r\n        x: size - offset,\r\n        y: offset,\r\n        points: [0, 0, -(size - offset * 2), 0],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 3) {\r\n      sym = new Arrow({\r\n        x: size - offset,\r\n        y: offset,\r\n        points: [0, 0, 0, size - offset * 2],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 4) {\r\n      sym = new Arrow({\r\n        x: size - offset,\r\n        y: size - offset,\r\n        points: [0, 0, 0, -(size - offset * 2)],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 5) {\r\n      sym = new Arrow({\r\n        x: size - offset,\r\n        y: size - offset,\r\n        points: [0, 0, -(size - offset * 2), 0],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 6) {\r\n      sym = new Arrow({\r\n        x: offset,\r\n        y: size - offset,\r\n        points: [0, 0, size - offset * 2, 0],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 7) {\r\n      sym = new Arrow({\r\n        x: offset,\r\n        y: size - offset,\r\n        points: [0, 0, 0, -(size - offset * 2)],\r\n        ...aopt,\r\n      });\r\n    }\r\n    if (symbol === 8) {\r\n      sym = new Arrow({\r\n        x: offset,\r\n        y: offset,\r\n        points: [0, 0, 0, size - offset * 2],\r\n        ...aopt,\r\n      });\r\n    }\r\n  }\r\n  if (page === 4) {\r\n    if (symbol === 1) {\r\n      sym = new Star({\r\n        x: cx,\r\n        y: cy,\r\n        innerRadius: size * 0.2,\r\n        outerRadius: size * 0.4,\r\n        numPoints: 5,\r\n        fill: color,\r\n        stroke: \"black\",\r\n      });\r\n    }\r\n    if (symbol === 2) {\r\n      let o = size * 0.1;\r\n      sym = new Line({\r\n        points: [o, o, size - o, size / 2, o, size - o, o, o],\r\n        fill: color,\r\n        closed: true,\r\n      });\r\n    }\r\n    if (symbol === 3) {\r\n      // Kakuro box\r\n      sym = new Group();\r\n      sym.add(new Rect({ width: size, height: size, fill: color }));\r\n      sym.add(\r\n        new Line({\r\n          points: [0, 0, size, size],\r\n          stroke: \"white\",\r\n          strokeWidth: strokeWidth,\r\n        })\r\n      );\r\n    }\r\n    if (symbol === 4) {\r\n      // Cross\r\n      let o = size * 0.1;\r\n      sym = new Group();\r\n      sym.add(\r\n        new Line({\r\n          x: cx - size / 2,\r\n          y: cy - size / 2,\r\n          points: [o, o, size - o, size - o],\r\n          stroke: color,\r\n          strokeWidth: strokeWidth,\r\n          listening: false,\r\n        })\r\n      );\r\n      sym.add(\r\n        new Line({\r\n          x: cx - size / 2,\r\n          y: cy - size / 2,\r\n          points: [o, size - o, size - o, o],\r\n          stroke: color,\r\n          strokeWidth: strokeWidth,\r\n          listening: false,\r\n        })\r\n      );\r\n    }\r\n    if (symbol === 5) {\r\n      let o = size * 0.1;\r\n      sym = new Line({\r\n        x: cx - size / 2,\r\n        y: cy - size / 2,\r\n        points: [o, o, size - o, size / 2, o, size - o],\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n        listening: false,\r\n      });\r\n    }\r\n    if (symbol === 6) {\r\n      let o = size * 0.1;\r\n      sym = new Line({\r\n        x: cx - size / 2,\r\n        y: cy - size / 2,\r\n        points: [size - o, o, o, size / 2, size - o, size - o],\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n        listening: false,\r\n      });\r\n    }\r\n    if (symbol === 7) {\r\n      let o = size * 0.1;\r\n      sym = new Line({\r\n        x: cx - size / 2,\r\n        y: cy - size / 2,\r\n        points: [o, o, size / 2, size - o, size - o, o],\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n        listening: false,\r\n      });\r\n    }\r\n    if (symbol === 8) {\r\n      let o = size * 0.1;\r\n      sym = new Line({\r\n        x: cx - size / 2,\r\n        y: cy - size / 2,\r\n        points: [o, size - o, size / 2, o, size - o, size - o],\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n        listening: false,\r\n      });\r\n    }\r\n  }\r\n  if (page === 5) {\r\n    let o = size * 0.1;\r\n    let rect = {\r\n      x: o,\r\n      y: o,\r\n      width: size - o * 2,\r\n      height: size - o * 2,\r\n      listening: false\r\n    };\r\n    if (symbol === 1) {\r\n      sym = new Rect({...rect,\r\n        fill: color,\r\n        stroke: \"black\",\r\n        strokeWidth: strokeWidth,\r\n      });\r\n    }\r\n    if (symbol === 2) {\r\n      sym = new Rect({...rect,\r\n        fill: null,\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n      });\r\n    }\r\n    if (symbol === 3) {\r\n      sym = new Rect({...rect,\r\n        fill: color,\r\n        stroke: \"black\",\r\n        strokeWidth: strokeWidth,\r\n        dash: [4],\r\n      });\r\n    }\r\n    if (symbol === 4) {\r\n      sym = new Rect({...rect,\r\n        fill: null,\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n        dash: [4],\r\n      });\r\n    }\r\n    if (symbol === 5) {\r\n      sym = new Rect({...rect,\r\n        fill: color,\r\n        strokeWidth: 0,\r\n      });\r\n    }\r\n  }\r\n  if (page === 6) {\r\n    let o = size * 0.1;\r\n    if (symbol === 1) {\r\n      sym = new Line({\r\n        x: cx,\r\n        y: o,\r\n        points: [0, 0, 0, size - o * 2],\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n        listening: false,\r\n      });\r\n    }\r\n    if (symbol === 2) {\r\n      sym = new Line({\r\n        x: o,\r\n        y: cy,\r\n        points: [0, 0, size - o * 2, 0],\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n        listening: false,\r\n      });\r\n    }\r\n    if (symbol === 3) {\r\n      sym = new Group();\r\n      sym.add(new Line({\r\n        x: o,\r\n        y: cy,\r\n        points: [0, 0, size - o * 2, 0],\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n        listening: false,\r\n      }));\r\n      sym.add(new Line({\r\n        x: cx,\r\n        y: o,\r\n        points: [0, 0, 0, size - o * 2],\r\n        stroke: color,\r\n        strokeWidth: strokeWidth,\r\n        listening: false,\r\n      }));\r\n    }\r\n  }\r\n  if (sym) {\r\n    if (container.symbol) {\r\n      container.symbol.destroy();\r\n    }\r\n    if (bg) {\r\n      let bgrect = new Rect({\r\n        width: size,\r\n        height: size,\r\n        fill: \"white\",\r\n        listening: false,\r\n      });\r\n      let c = new Group();\r\n      c.add(bgrect, sym);\r\n      container.symbol = c;\r\n      container.add(c);\r\n    } else {\r\n      container.symbol = sym;\r\n      container.add(sym);\r\n    }\r\n    container.symboltext = str;\r\n    container.symbolcolor = _color;\r\n    container.symbolbg = bg;\r\n  }\r\n}\r\n","import { Stage, Layer, Text, Rect, Group, Line, Circle, Util } from \"konva\";\r\nimport { DrawCage } from \"./cage\";\r\nimport { DrawPath } from \"./path\";\r\nimport { DrawSymbol } from \"./symbols\";\r\nimport pako from \"pako\";\r\nimport msgpack from \"msgpack-lite\";\r\nimport { isEqual, range, findLastIndex, last } from \"lodash\";\r\n\r\nlet ctx = {};\r\nlet cell_size = 0;\r\nlet grid_w = null;\r\nlet grid_h = null;\r\nlet main_w = null;\r\nlet main_h = null;\r\nlet grid_left = 0;\r\nlet grid_top = 0;\r\nlet grid_bottom = 0;\r\nlet grid_right = 0;\r\nlet grid_div_width = 0;\r\nlet grid_div_height = 0;\r\nlet grid_style = \"normal\";\r\nlet grid_left_diagonal = false;\r\nlet grid_right_diagonal = false;\r\nlet hover_offset = 0;\r\nlet symbol_page = 0;\r\nlet multi_digit = false;\r\nlet number_bg = false;\r\nlet cursor_visible = true;\r\n\r\n// Factors for line and circle radius on commoon elements\r\nconst thin_grid_line = 0.01;\r\nconst medium_grid_line = 0.07;\r\nconst fat_grid_line = 0.2;\r\nconst radius = 0.4;\r\n\r\nconst type_path = 1;\r\nconst type_cage = 2;\r\n\r\nconst lock_normal = 1;\r\nconst lock_color = 2;\r\nconst lock_boundary = 3;\r\n\r\nconst b_corner = 1;\r\nconst b_side = 2;\r\nconst b_quarter = 3;\r\nconst b_boundary = 4;\r\nconst b_edge = 5;\r\nconst b_bigboundary = 6;\r\n\r\nconst b_left = 1;\r\nconst b_top = 2;\r\nconst b_bottom = 3;\r\nconst b_right = 4;\r\n\r\nconst sol_text_color = \"rgb(29, 106, 229)\";\r\nconst mark_color = \"rgba(247, 208, 56, 0.5)\";\r\nexport const DrawColors = [\r\n  \"rgba(0, 0, 0, 1)\",\r\n  \"rgba(207, 207, 207, 0.5)\",\r\n  \"rgba(255, 255, 255, 1)\",\r\n  \"rgba(163, 224, 72, 0.5)\",\r\n  \"rgba(210, 59, 231, 0.5)\",\r\n  \"rgba(235, 117, 50, 0.5)\",\r\n  \"rgba(226, 38, 31, 0.5)\",\r\n  \"rgba(247, 208, 56, 0.5)\",\r\n  \"rgba(52, 187, 230, 0.5)\",\r\n  //\r\n  \"rgba(140, 140, 140, 0.5)\",\r\n  \"rgba(80, 80, 80, 0.5)\",\r\n  \"rgba(20, 20, 20, 0.5)\",\r\n];\r\n\r\nexport function DrawColorPremul(color) {\r\n  if (typeof color === \"number\") {\r\n    color = DrawColors[color];\r\n  }\r\n  // Premultiply for thermo\r\n  color = Util.colorToRGBA(color);\r\n  color.r = color.r * color.a + (1 - color.a) * 255;\r\n  color.g = color.g * color.a + (1 - color.a) * 255;\r\n  color.b = color.b * color.a + (1 - color.a) * 255;\r\n  color.a = 1;\r\n  return `rgba(${color.r}, ${color.g}, ${color.b}, ${color.a})`;\r\n}\r\n\r\nlet current_color = 0;\r\nlet current_mode = \"normal\";\r\nlet current_rmode = null;\r\nlet current_style = null;\r\nlet solve_mode = false;\r\nlet scene = null;\r\nlet matrix = [];\r\nlet stuff = [];\r\nlet edges = {};\r\nlet drag = false;\r\nlet drag_toggle = null;\r\nlet drag_button = -1;\r\nlet undo_stack = [];\r\nlet redo_stack = [];\r\nlet current = null;\r\nlet outer = null;\r\nlet underlay = null;\r\nlet shift = false;\r\nlet cursor = null;\r\nlet boundary = null;\r\nlet grid_lines = [];\r\n\r\nfunction reset() {\r\n  matrix = [];\r\n  stuff = [];\r\n  edges = {};\r\n  undo_stack = [];\r\n  redo_stack = [];\r\n  current = null;\r\n  outer = null;\r\n  underlay = null;\r\n  shift = false;\r\n  cursor = null;\r\n}\r\n\r\nexport function DrawSetSymbolPage(page) {\r\n  symbol_page = page;\r\n}\r\n\r\nclass RectHolder {\r\n  constructor(container, width, height) {\r\n    this.container = container;\r\n    this.width = width;\r\n    this.height = height;\r\n    this.color = null;\r\n    this.obj = null;\r\n  }\r\n\r\n  fill(color) {\r\n    if (color === undefined) return this.color;\r\n\r\n    this.color = color;\r\n    if (color === null) {\r\n      if (this.obj) {\r\n        this.obj.destroy();\r\n        this.obj = null;\r\n      }\r\n    } else {\r\n      if (this.obj === null) {\r\n        this.obj = new Rect({ width: this.width, height: this.height });\r\n        this.container.add(this.obj);\r\n      }\r\n      this.obj.fill(this.color);\r\n    }\r\n  }\r\n}\r\n\r\nclass TextHolder {\r\n  constructor(container, color, fontSize, size) {\r\n    this.container = container;\r\n    this._color = color;\r\n    this.fontSize = fontSize;\r\n    this.size = size;\r\n    this._text = \"\";\r\n    this.obj = null;\r\n  }\r\n\r\n  text(t) {\r\n    if (t === undefined) return this._text;\r\n\r\n    this._text = t;\r\n    if (this._text.length > 0) {\r\n      if (!this.obj) {\r\n        this.obj = new Text({\r\n          fill: this._color,\r\n          text: this._text,\r\n          fontSize: this.fontSize,\r\n          listening: false\r\n        });\r\n        this.container.add(this.obj);\r\n      } else this.obj.text(this._text);\r\n      let meas = this.obj.measureSize(this._text);\r\n      this.obj.position({\r\n        x: (this.size - meas.width) / 2,\r\n        y: (this.size - meas.height) / 2,\r\n      });\r\n    } else if (this.obj) {\r\n      this.obj.destroy();\r\n      this.obj = null;\r\n    }\r\n  }\r\n\r\n  color(c) {\r\n    if (c === undefined) return this._color;\r\n\r\n    this._color = c;\r\n    if (this.obj) this.obj.fill(this._color);\r\n  }\r\n}\r\n\r\nfunction setSymbol(container, str, color, _size, bg) {\r\n  let text;\r\n  let size = _size;\r\n  if (container.normal) {\r\n    if (typeof color === \"number\") color = DrawColors[color];\r\n    size = cell_size;\r\n    text = container.normal.text;\r\n    if (multi_digit) str = text.text() + str;\r\n    container = container.symcont;\r\n  } else if (size > 0) {\r\n    // Symbol page\r\n    color = \"gray\";\r\n  } else {\r\n    size = container.bsize;\r\n    if (multi_digit && str !== \"\") str = (container.symboltext || \"\") + str;\r\n  }\r\n  if (str[0] === \"#\" || !text) {\r\n    DrawSymbol(ctx, container, str, color, size, bg);\r\n  } else {\r\n    text.text(str);\r\n    text.color(color);\r\n  }\r\n}\r\n\r\nexport function DrawSymbolElement(element, page, num, size) {\r\n  let stage = new Stage({ container: element, width: size, height: size, listening: false });\r\n  let layer = new Layer({ listening: false});\r\n  setSymbol(layer, \"#\" + page + num, current_color, size);\r\n  stage.add(layer);\r\n  stage.draw();\r\n}\r\n\r\nfunction saveState() {\r\n  let state = [];\r\n  each_cell((m) => {\r\n    let s = { x: m.x, y: m.y };\r\n    if (m.normal.text.text() !== \"\") s.normal = m.normal.text.text();\r\n    else {\r\n      if (m.center.text.text() !== \"\") s.center = m.center.text.text();\r\n      s.corner = m.corner.map((c) => c.text.text());\r\n    }\r\n    if (m.r_color.rect.fill()) {\r\n      s.color = m.r_color.rect.fill();\r\n    }\r\n    if (m.cross) s.cross = true;\r\n    s.edge = [];\r\n    s.centerline = [];\r\n    s.edgecross = [];\r\n    m.boundary.forEach((b, i) => {\r\n      if (b.edge && !b.lock) s.edge.push(i);\r\n      if (b.cross) s.edgecross.push(i);\r\n      if (b.centerline) s.centerline.push(i);\r\n    });\r\n    state.push(s);\r\n  });\r\n  return state;\r\n}\r\n\r\nfunction saveUndo() {\r\n  let state = saveState();\r\n  undo_stack.push(state);\r\n}\r\n\r\nfunction loadState(state) {\r\n  state.forEach((s) => {\r\n    let m = get(s.x, s.y);\r\n    setCell([s.x, s.y], \"reset\", null, \"\", false);\r\n    if (s.normal) m.normal.text.text(s.normal);\r\n    else {\r\n      if (s.center) m.center.text.text(s.center);\r\n      if (s.corner) s.corner.forEach((c, i) => m.corner[i].text.text(c));\r\n    }\r\n    if (s.color) m.r_color.rect.fill(s.color);\r\n    else m.r_color.rect.fill(null);\r\n    if (s.cross) drawCross(s.x, s.y, true);\r\n    s.edge.forEach(i => drawEdge(s.x, s.y, i, true));\r\n    s.edgecross.forEach(i => drawEdgeCross(s.x, s.y, i, true));\r\n    s.centerline.forEach(i => drawCenterLine(s.x, s.y, i, true));\r\n  });\r\n}\r\n\r\nfunction _setCell(lock, pos, mode, color, newtext, bg) {\r\n  let x = pos[0];\r\n  let y = pos[1];\r\n  let b = null;\r\n  if (pos.length === 3) b = get(...pos);\r\n  let m = get(x, y);\r\n\r\n  if (!m.main_grid && mode !== \"normal\" && !lock && mode !== \"reset\") {\r\n    return;\r\n  }\r\n  if (m.lock_type === lock_normal && !lock && mode !== \"color\" && mode !== \"reset\") {\r\n    return;\r\n  }\r\n\r\n  if (mode === \"reset\") {\r\n    m.center.text.text(\"\");\r\n    if (m.lock_type !== lock_normal || lock)\r\n      m.normal.text.text(\"\");\r\n    m.corner.forEach((c) => c.text.text(\"\"));\r\n    m.r_color.rect.fill(null);\r\n    if (m.cross) {\r\n      m.cross.destroy();\r\n      m.cross = null;\r\n    }\r\n    m.boundary.forEach((b) => {\r\n      if (b.edge && !b.lock) {\r\n        b.edge.destroy();\r\n        b.edge = null;\r\n        delete edges[[x, y, b.bindex]];\r\n      }\r\n      if (b.centerline) {\r\n        b.centerline.destroy();\r\n        b.centerline = null;\r\n      }\r\n      if (b.cross) {\r\n        b.cross.destroy();\r\n        b.cross = null;\r\n      }\r\n    });\r\n    if (lock) {\r\n      m.r_color_set.rect.fill(null);\r\n      m.fill = -1;\r\n      if (m.symcont.symbol) {\r\n        m.symcont.symbol.destroy();\r\n        m.symcont.symbol = null;\r\n        m.symcont.symboltext = \"\";\r\n      }\r\n      m.boundary.forEach((b) => {\r\n        if (b.symbol) {\r\n          b.symbol.destroy();\r\n          b.symbol = null;\r\n          b.symboltext = \"\";\r\n          console.log(\"reset boundary\");\r\n        }\r\n        if (b.rect) {\r\n          b.rect.destroy();\r\n          b.rect = null;\r\n        }\r\n        if (b.edge) {\r\n          b.edge.destroy();\r\n          b.edge = null;\r\n          delete edges[[x, y, b.bindex]];\r\n        }\r\n        b.text.text(\"\");\r\n      });\r\n    }\r\n  } else if (b) {\r\n    setSymbol(b, newtext, color, 0, bg);\r\n  } else if (mode === \"normal\") {\r\n    if (!lock) {\r\n      color = sol_text_color;\r\n    } else {\r\n      m.lock_type = newtext !== \"\" ? lock_normal : 0;\r\n      if (newtext[0] !== \"#\") {\r\n        m.color = color;\r\n      }\r\n    }\r\n    setSymbol(m, newtext, color);\r\n    if (newtext[0] !== \"#\") {\r\n      m.center.text.text(\"\");\r\n      m.corner.forEach((c) => c.text.text(\"\"));\r\n    }\r\n  } else if (mode === \"center\" && m.normal.text.text() === \"\") {\r\n    let current = m.center.text.text();\r\n    let center = \"\";\r\n    if (newtext !== \"\") {\r\n      for (let i = 1; i <= 9; ++i) {\r\n        if (\r\n          (current.indexOf(i) === -1 && i === +newtext) ||\r\n          (current.indexOf(i) !== -1 && i !== +newtext)\r\n        ) {\r\n          center += i;\r\n        }\r\n      }\r\n    }\r\n\r\n    m.center.text.text(center);\r\n  } else if (mode === \"corner\" && m.normal.text.text() === \"\") {\r\n    let current = \"\";\r\n    m.corner.forEach((t) => (current += t.text.text()));\r\n    let text = \"\";\r\n    if (newtext !== \"\") {\r\n      for (let i = 1; i <= 9; ++i) {\r\n        if (\r\n          (current.indexOf(i) === -1 && i === +newtext) ||\r\n          (current.indexOf(i) !== -1 && i !== +newtext)\r\n        ) {\r\n          text += i;\r\n        }\r\n      }\r\n    }\r\n    let i = 0;\r\n    m.corner.forEach((c) => c.text.text(text[i++] || \"\"));\r\n  } else if (mode === \"color\") {\r\n    // white == clear\r\n    if (!lock) {\r\n      if (color === 2) {\r\n        m.r_color.rect.fill(null);\r\n      } else {\r\n        m.r_color.rect.fill(DrawColors[color]);\r\n      }\r\n    } else {\r\n      if (color === 2) {\r\n        m.r_color_set.rect.fill(null);\r\n        m.fill = null;\r\n      } else {\r\n        m.r_color_set.rect.fill(DrawColors[color]);\r\n        m.fill = color;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction keyup(event) {\r\n  if (event.key === \"Shift\") {\r\n    shift = false;\r\n  }\r\n}\r\n\r\nfunction setCell(pos, mode, color, newtext, bg) {\r\n  let lock = !solve_mode;\r\n  _setCell(lock, pos, mode, color, newtext, bg);\r\n}\r\n\r\nfunction lock_cell(pos, mode, color, newtext, bg) {\r\n  _setCell(true, pos, mode, color, newtext, bg);\r\n}\r\n\r\nexport function DrawSetNumber(number) {\r\n  saveUndo();\r\n\r\n  let symbol = \"\" + number;\r\n  if (symbol_page > 0) symbol = \"#\" + symbol_page + number;\r\n  if (boundary) {\r\n    setCell(boundary, \"boundary\", current_color, symbol, number_bg);\r\n  } else {\r\n    let count = 0;\r\n    let mode = current_mode;\r\n    each_mark((m) => ++count);\r\n    if (count > 1 && solve_mode && mode === \"normal\") mode = \"center\";\r\n    each_mark((m) => setCell([m.x, m.y], mode, current_color, symbol, false));\r\n  }\r\n  scene.draw();\r\n}\r\n\r\nexport function DrawSetColor(color_index) {\r\n  saveUndo();\r\n\r\n  current_color = color_index;\r\n  if (current_mode === \"color\") {\r\n    each_mark((m) => {\r\n      setCell([m.x, m.y], \"color\", color_index, null, false);\r\n    });\r\n    scene.draw();\r\n  }\r\n}\r\n\r\nfunction keydown(event) {\r\n  if (event.target.tagName === \"TEXTAREA\") {\r\n    return;\r\n  }\r\n\r\n  let newtext;\r\n  if (event.key === \"Shift\") {\r\n    shift = true;\r\n    return;\r\n  } else if (event.key === \"Delete\" || event.key === \"Backspace\") {\r\n    DrawDelete();\r\n    event.preventDefault();\r\n    return;\r\n  } else if (event.key >= \"0\" && event.key <= \"9\") {\r\n    newtext = event.key;\r\n    if (symbol_page > 0) newtext = \"#\" + symbol_page + newtext;\r\n  } else if (event.key === \"u\" && solve_mode) {\r\n    DrawUndo();\r\n    return;\r\n  } else if (\r\n    event.key.length === 1 &&\r\n    (\"?!()+-*%&/:-\".includes(event.key) ||\r\n      (event.key >= \"a\" && event.key <= \"z\") ||\r\n      (event.key >= \"A\" && event.key <= \"Z\")) &&\r\n    !solve_mode\r\n  ) {\r\n    newtext = event.key;\r\n  } else if (event.key.startsWith(\"Arrow\") && cursor) {\r\n    let c = cursor.slice();\r\n    if (!shift) unmark();\r\n    cursor = c;\r\n    if (event.key === \"ArrowUp\") cursor[1] -= 1;\r\n    if (cursor[1] < 0) cursor[1] = grid_h - 1;\r\n    if (event.key === \"ArrowDown\") cursor[1] += 1;\r\n    if (cursor[1] >= grid_h) cursor[1] = 0;\r\n    if (event.key === \"ArrowLeft\") cursor[0] -= 1;\r\n    if (cursor[0] < 0) cursor[0] = grid_w - 1;\r\n    if (event.key === \"ArrowRight\") cursor[0] += 1;\r\n    if (cursor[0] >= grid_w) cursor[0] = 0;\r\n    mark(cursor[0], cursor[1]);\r\n    scene.draw();\r\n    return;\r\n  } else {\r\n    return;\r\n  }\r\n\r\n  saveUndo();\r\n\r\n  if (boundary) {\r\n    setCell(boundary, \"boundary\", current_color, newtext, number_bg);\r\n  } else {\r\n    let count = 0;\r\n    each_mark((m) => ++count);\r\n\r\n    let mode = current_mode;\r\n    if (count > 1 && solve_mode && mode === \"normal\") mode = \"center\";\r\n    each_mark((m) => {\r\n      if (current_mode === \"color\") {\r\n        let color = +newtext - 1;\r\n        if (color >= 0 && color <= 9)\r\n          setCell([m.x, m.y], current_mode, color, null, false);\r\n      } else setCell([m.x, m.y], mode, current_color, newtext, false);\r\n    });\r\n  }\r\n  scene.draw();\r\n}\r\n\r\nfunction get(x, y, b) {\r\n  if (x < 0 || y < 0 || x >= grid_w || y >= grid_h) {\r\n    return null;\r\n  }\r\n  let m = matrix[y][x];\r\n  if (b >= 0) return m.boundary[b];\r\n  return m;\r\n}\r\n\r\nfunction mark(x, y) {\r\n  let m = get(x, y);\r\n  cursor = [x, y];\r\n  if (!m.mark) {\r\n    m.mark = true;\r\n    m.rect.fill(mark_color);\r\n    m.rect.fillEnabled(cursor_visible);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction inner_mousemove(event, x, y) {\r\n  if (!drag) return;\r\n  if (drag_button !== 0) return;\r\n\r\n  if (current_mode === \"path\") {\r\n    if (current.cells.length > 0) {\r\n      let l = last(current.cells);\r\n      if (l[0] === x && l[1] === y) return;\r\n    }\r\n    current.objs.forEach((o) => o.destroy());\r\n    current.cells.push([x, y]);\r\n    current.objs = DrawPath(ctx, current.cells, current_style, current_color);\r\n    scene.draw();\r\n  }\r\n}\r\n\r\nlet last_toggle_state = null;\r\n\r\nfunction getLineWidth(style, size) {\r\n  if (size === undefined)\r\n    size = cell_size;\r\n  switch (style) {\r\n    case \"thin\":\r\n      return size * thin_grid_line;\r\n    case \"medium\":\r\n      return size * medium_grid_line;\r\n    default:\r\n      return size * fat_grid_line;\r\n  }\r\n}\r\n\r\nfunction drawEdge(x, y, i, set, style, color, lock = false) {\r\n  let m = get(x, y);\r\n  let b = m.boundary[i];\r\n  let c = solve_mode ? sol_text_color : DrawColors[current_color];\r\n  let width = solve_mode ? getLineWidth(\"fat\") : getLineWidth(style);\r\n  let eo = cell_size * 0.15;\r\n\r\n  if (!set) {\r\n    if (b.edge) {\r\n      b.edge.destroy();\r\n      b.edge = null;\r\n      delete edges[[x, y, i]];\r\n    }\r\n  }\r\n  else if (!b.edge) {\r\n    let edge;\r\n    let new_edge = (x, y, x1, y1) => {\r\n      edge = new Line({\r\n        x: x,\r\n        y: y,\r\n        points: [0, 0, x1, y1],\r\n        strokeWidth: width,\r\n        stroke: c,\r\n        lineCap: \"round\",\r\n        listening: false,\r\n      });\r\n    };\r\n    switch (b.btype2) {\r\n      case b_left:\r\n      case b_right:\r\n        new_edge(eo, -eo, 0, cell_size);\r\n        break;\r\n      case b_top:\r\n      case b_bottom:\r\n        new_edge(-eo, eo, cell_size, 0);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    edges[[x, y, i]] = [style, color];\r\n    b.edge = edge;\r\n    b.lock = lock;\r\n    b.add(edge);\r\n  }\r\n}\r\n\r\nfunction edgeToggle(x, y, i, style, color, lock) {\r\n  let m = get(x, y);\r\n  let b = m.boundary[i];\r\n  let set;\r\n\r\n  if (b.lock && solve_mode) return;\r\n\r\n  if (last_toggle_state === null) {\r\n    if (b.edge) last_toggle_state = true;\r\n    else last_toggle_state = false;\r\n  }\r\n  set = !last_toggle_state;\r\n\r\n  drawEdge(x, y, i, set, style, color, lock);\r\n}\r\n\r\nfunction drawCenterLine(x, y, i, set, style, color) {\r\n  let m = get(x, y);\r\n  let b = m.boundary[i];\r\n  let c = solve_mode ? sol_text_color : DrawColors[current_color];\r\n  if (color !== undefined) c = DrawColors[color];\r\n  let width = getLineWidth(style);\r\n\r\n  if (!set) {\r\n    if (b.centerline) {\r\n      b.centerline.destroy();\r\n      b.centerline = null;\r\n    }\r\n  } else if (!b.centerline) {\r\n    let points;\r\n    let cp = cell_size / 2;\r\n    let bw = b.bwidth / 2;\r\n    let bh = b.bheight / 2;\r\n    if (b.btype2 === b_top || b.btype2 === b_bottom) {\r\n      if (b.btype2 === b_top && m.y <= grid_top) return;\r\n      if (b.btype2 === b_bottom && m.y >= grid_top + grid_h - 1) return;\r\n      points = [0, -cp, 0, cp];\r\n    } else {\r\n      if (b.btype2 === b_left && m.x <= grid_left) return;\r\n      if (b.btype2 === b_right && m.x >= grid_left + grid_w - 1) return;\r\n      points = [-cp, 0, cp, 0];\r\n    }\r\n\r\n    let cline = new Line({\r\n      x: bw,\r\n      y: bh,\r\n      points: points,\r\n      strokeWidth: width,\r\n      stroke: c,\r\n      lineCap: \"round\",\r\n      listening: false,\r\n    });\r\n    b.centerline = cline;\r\n    b.add(cline);\r\n  }\r\n}\r\n\r\nfunction centerLineToggle(x, y, i, style, color) {\r\n  let m = get(x, y);\r\n  let b = m.boundary[i];\r\n  let set;\r\n\r\n  if (last_toggle_state === null) {\r\n    if (b.centerline) last_toggle_state = true;\r\n    else last_toggle_state = false;\r\n  }\r\n  set = !last_toggle_state;\r\n\r\n  drawCenterLine(x, y, i, set, style, color);\r\n}\r\n\r\nlet last_toggle = { x: -1, y: -1, i: -1 };\r\n\r\nfunction hasCross(x, y) {\r\n  let m = get(x, y);\r\n  return !!m.cross;\r\n}\r\n\r\nfunction drawCross(x, y, set) {\r\n  let m = get(x, y);\r\n  if (set) {\r\n    if (!m.cross) {\r\n      m.cross = new Group();\r\n      m.add(m.cross);\r\n      DrawSymbol(ctx, m.cross, \"#44\", sol_text_color, cell_size);\r\n    }\r\n  } else {\r\n    if (m.cross) {\r\n      m.cross.destroy();\r\n      m.cross = null;\r\n    }\r\n  }\r\n}\r\n\r\nfunction hasEdgeCross(x, y, i) {\r\n  let b = get(x, y).boundary[i];\r\n  return !!b.cross;\r\n}\r\n\r\nfunction drawEdgeCross(x, y, i, set) {\r\n  let b = get(x, y).boundary[i];\r\n  if (set) {\r\n    if (!b.cross) {\r\n      b.cross = new Group();\r\n      b.add(b.cross);\r\n      DrawSymbol(ctx, b.cross, \"#44\", sol_text_color, [b.bwidth, b.bheight]);\r\n    }\r\n  } else if (b.cross) {\r\n    b.cross.destroy();\r\n    b.cross = null;\r\n  }\r\n}\r\n\r\nfunction edgeMousemove(event, x, y, i) {\r\n  if (!drag) return;\r\n  if (last_toggle.x === x && last_toggle.y === y && last_toggle.i === i) return;\r\n  last_toggle = { x: x, y: y, i: i };\r\n\r\n  saveUndo();\r\n\r\n  if (drag_button === 2 && current_rmode === \"edgecross\") {\r\n    if (i !== undefined) {\r\n      drawEdgeCross(x, y, i, drag_toggle);\r\n      scene.draw();\r\n    }\r\n    return;\r\n  }\r\n\r\n  unmark();\r\n\r\n  if (current_mode === \"edge\") {\r\n    edgeToggle(x, y, i, current_style, current_color);\r\n  } else {\r\n    centerLineToggle(x, y, i, current_style, current_color);\r\n  }\r\n  scene.draw();\r\n}\r\n\r\nlet last_move = [-1, -1];\r\n\r\nfunction mousemove(event, x, y) {\r\n  if (x === last_move[0] && y === last_move[1]) return;\r\n\r\n  last_move[0] = x;\r\n  last_move[1] = y;\r\n\r\n  if (!drag) return;\r\n\r\n  if (drag_button === 2 && current_rmode === \"edgecross\") return;\r\n\r\n  if (drag_button === 2 && current_rmode === \"cross\") {\r\n    drawCross(x, y, drag_toggle);\r\n    scene.draw();\r\n    return;\r\n  }\r\n\r\n  if (\r\n    current_mode === \"path\" ||\r\n    current_mode === \"edge\" ||\r\n    current_mode === \"centerline\"\r\n  ) {\r\n  } else if (current_mode === \"cage\") {\r\n    if (current.cells.length > 0) {\r\n      let l = last(current.cells);\r\n      if (l[0] === x && l[1] === y) return;\r\n    }\r\n    if (current.objs) current.objs.forEach((o) => o.destroy());\r\n    current.cells.push([x, y]);\r\n    current.objs = DrawCage(ctx, current.cells, current_style, current_color);\r\n  } else {\r\n    mark(x, y);\r\n  }\r\n\r\n  scene.draw();\r\n}\r\n\r\nfunction mark_boundary(x, y, i) {\r\n  unmark();\r\n\r\n  let b = get(x, y).boundary[i];\r\n  if (!b.rect) {\r\n    b.rect = new Rect({\r\n      width: b.bwidth,\r\n      height: b.bheight,\r\n      fillEnabled: false,\r\n    });\r\n    b.add(b.rect);\r\n  }\r\n  b.rect.stroke(\"red\");\r\n  b.rect.strokeWidth(1);\r\n  boundary = [x, y, i];\r\n}\r\n\r\nfunction unmark() {\r\n  if (boundary) {\r\n    let r = get(...boundary).rect;\r\n    if (r) r.strokeWidth(0);\r\n    boundary = null;\r\n  }\r\n  each_mark((m) => {\r\n    m.rect.fill(null);\r\n    m.mark = false;\r\n  });\r\n  cursor = null;\r\n}\r\n\r\nfunction boundary_mousedown(event, x, y, i) {\r\n  mark_boundary(x, y, i);\r\n  scene.draw();\r\n}\r\n\r\nfunction contextmenu(event) {\r\n  if (event.target.tagName === \"CANVAS\") event.preventDefault();\r\n}\r\n\r\nfunction window_mousedown(event) {\r\n  if (event.target.tagName === \"HTML\") {\r\n    unmark();\r\n    scene.draw();\r\n  }\r\n  last_move = [-1, -1];\r\n}\r\n\r\nfunction mousedown(event, x, y, i) {\r\n  event.evt.stopPropagation();\r\n\r\n  drag = true;\r\n  if (event.evt.type === \"touchstart\") drag_button = 0;\r\n  else drag_button = event.evt.button;\r\n\r\n  if (event.evt.button === 2 && current_rmode === \"edgecross\") {\r\n    if (i !== undefined) {\r\n      drag_toggle = !hasEdgeCross(x, y, i);\r\n      saveUndo();\r\n      drawEdgeCross(x, y, i, drag_toggle);\r\n      scene.draw();\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (event.evt.button === 2 && current_rmode === \"cross\") {\r\n    drag_toggle = !hasCross(x, y);\r\n    saveUndo();\r\n    drawCross(x, y, drag_toggle);\r\n    scene.draw();\r\n    return;\r\n  }\r\n\r\n  if (!shift) {\r\n    unmark();\r\n  }\r\n\r\n  if (boundary) {\r\n    get(...boundary).strokeWidth(0);\r\n    boundary = null;\r\n  }\r\n\r\n  if (current_mode === \"path\") {\r\n    current = { cells: [[x, y]], color: current_color };\r\n    current.objs = DrawPath(ctx, current.cells, current_style, current_color);\r\n  } else if (current_mode === \"cage\") {\r\n    current = { cells: [[x, y]], color: current_color };\r\n    current.objs = DrawCage(ctx, current.cells, current_style, current_color);\r\n  } else if (current_mode === \"edge\" && i !== undefined) {\r\n    saveUndo();\r\n    edgeToggle(x, y, i, current_style, current_color);\r\n  } else if (current_mode === \"centerline\" && i !== undefined) {\r\n    saveUndo();\r\n    centerLineToggle(x, y, i, current_style, current_color);\r\n  } else {\r\n    mark(x, y);\r\n  }\r\n\r\n  scene.draw();\r\n}\r\n\r\nfunction edgeMouseup(event, x, y, i) {\r\n  if (event.evt.button === 2) return;\r\n  if (last_toggle_state === null && current_mode === \"edge\") {\r\n    edgeToggle(x, y, i, current_style, current_color);\r\n  }\r\n}\r\n\r\nfunction mouseup() {\r\n  drag = false;\r\n  last_toggle_state = null;\r\n\r\n  if (current_mode === \"path\" && current) {\r\n    stuff.push({\r\n      type: type_path,\r\n      style: current_style,\r\n      cells: current.cells,\r\n      objs: current.objs,\r\n      color: current_color,\r\n    });\r\n    cursor = last(current.cells);\r\n    current = null;\r\n  } else if (current_mode === \"cage\" && current) {\r\n    stuff.push({\r\n      type: type_cage,\r\n      style: current_style,\r\n      cells: current.cells,\r\n      objs: current.objs,\r\n      color: current_color,\r\n    });\r\n    cursor = last(current.cells);\r\n    current = null;\r\n  }\r\n}\r\n\r\nexport function DrawSetMode(state) {\r\n  current_mode = state.mode;\r\n  number_bg = state.numberBackground;\r\n  multi_digit = state.multiDigit;\r\n\r\n  each_cell((m) =>\r\n    m.boundary.forEach((b) => {\r\n      if (b.rect) {\r\n        b.rect.destroy();\r\n        b.rect = null;\r\n      }\r\n    })\r\n  );\r\n\r\n  cursor_visible = false;\r\n\r\n  if (state.mode === \"cage\") current_style = state.cageStyle;\r\n  else if (state.mode === \"path\") current_style = state.pathStyle;\r\n  else if (state.mode === \"edge\") current_style = state.edgeStyle;\r\n  else if (state.mode === \"edgecross\") {\r\n    current_mode = \"edge\";\r\n    current_style = \"fat\";\r\n    current_color = undefined;\r\n    current_rmode = \"edgecross\";\r\n  } else if (state.mode === \"centerline\") {\r\n    current_mode = \"centerline\";\r\n    current_style = \"fat\";\r\n    current_color = undefined;\r\n    current_rmode = \"edgecross\";\r\n  } else if (\r\n    (state.mode === \"normal\" || state.mode === \"number\") &&\r\n    state.numberStyle === \"normal\"\r\n  ) {\r\n    current_mode = \"normal\";\r\n    cursor_visible = true;\r\n  } else cursor_visible = true;\r\n\r\n  if (!cursor_visible) unmark();\r\n\r\n  if (current_mode === \"edge\" || current_mode === \"centerline\") {\r\n    each_cell((m) =>\r\n      m.boundary.forEach((b, i) => {\r\n        if (b.btype === b_edge) {\r\n          if (!b.rect) {\r\n            b.rect = new Rect({\r\n              width: b.bwidth,\r\n              height: b.bheight,\r\n              fill: null,\r\n              fillEnabled: false,\r\n            });\r\n            b.add(b.rect);\r\n          }\r\n          b.rect.fillEnabled(true);\r\n          b.rect.on(\"mousemove touchmove\", (event) =>\r\n            edgeMousemove(event, m.x, m.y, i)\r\n          );\r\n          b.rect.on(\"mousedown tap touchstart\", (event) =>\r\n            mousedown(event, m.x, m.y, i)\r\n          );\r\n          b.rect.on(\"mouseup touchend\", (event) =>\r\n            edgeMouseup(event, m.x, m.y, i)\r\n          );\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  let setBoundary = (type) => {\r\n    each_cell((m) =>\r\n      m.boundary.forEach((b, i) => {\r\n        if (b.btype === type) {\r\n          if (!b.rect) {\r\n            b.rect = new Rect({\r\n              width: b.bwidth,\r\n              height: b.bheight,\r\n              fill: null,\r\n              fillEnabled: true,\r\n            });\r\n            b.add(b.rect);\r\n          }\r\n          b.rect.on(\"mousedown touchstart tap\", (event) =>\r\n            boundary_mousedown(event, m.x, m.y, i)\r\n          );\r\n        }\r\n      })\r\n    );\r\n  };\r\n\r\n  if (state.mode === \"number\" && state.numberStyle === \"corner\") {\r\n    current_mode = \"boundary\";\r\n    setBoundary(b_corner);\r\n  }\r\n  if (state.mode === \"number\" && state.numberStyle === \"side\") {\r\n    current_mode = \"boundary\";\r\n    setBoundary(b_side);\r\n  }\r\n  if (state.mode === \"number\" && state.numberStyle === \"quarter\") {\r\n    current_mode = \"boundary\";\r\n    setBoundary(b_quarter);\r\n  }\r\n  if (state.mode === \"number\" && state.numberStyle === \"boundary\") {\r\n    current_mode = \"boundary\";\r\n    setBoundary(b_boundary);\r\n  }\r\n  if (state.mode === \"number\" && state.numberStyle === \"bigboundary\") {\r\n    current_mode = \"boundary\";\r\n    setBoundary(b_bigboundary);\r\n  }\r\n  scene.draw();\r\n}\r\n\r\nfunction each_cell(f) {\r\n  for (let x = 0; x < grid_w; ++x) {\r\n    for (let y = 0; y < grid_h; ++y) {\r\n      let m = get(x, y);\r\n      f(m);\r\n    }\r\n  }\r\n}\r\n\r\nfunction each_mark(f) {\r\n  for (let x = 0; x < grid_w; ++x) {\r\n    for (let y = 0; y < grid_h; ++y) {\r\n      let m = get(x, y);\r\n      if (m.mark) f(m);\r\n    }\r\n  }\r\n}\r\n\r\nfunction unserialize_grid(s) {\r\n  [\r\n    cell_size,\r\n    grid_w,\r\n    grid_h,\r\n    grid_left,\r\n    grid_right,\r\n    grid_top,\r\n    grid_bottom,\r\n    grid_div_width,\r\n    grid_div_height,\r\n    grid_style,\r\n    grid_left_diagonal,\r\n    grid_right_diagonal,\r\n  ] = s;\r\n}\r\n\r\nfunction load_grid(base64) {\r\n  let pack = Uint8Array.from(atob(base64), (c) => c.charCodeAt(0));\r\n  let unpack = pako.inflate(pack);\r\n  let data = msgpack.decode(unpack);\r\n\r\n  if (data.version !== 1) {\r\n    alert(\"Bad version\");\r\n  }\r\n\r\n  unserialize_grid(data.grid);\r\n}\r\n\r\nfunction unserialize(data) {\r\n  stuff = [];\r\n  each_cell((m) => {\r\n    m.lock_type = 0;\r\n    m.normal.text.text(\"\");\r\n    m.center.text.text(\"\");\r\n  });\r\n\r\n  if (data.edges) {\r\n    for (const k in data.edges) {\r\n      let pos = k.split(\",\").map((x) => +x);\r\n      let [style, color] = data.edges[k];\r\n      edgeToggle(...pos, style, color, true);\r\n    }\r\n  }\r\n\r\n  data.cells.forEach((c) => {\r\n    let [pos, type, text, color, bg] = c;\r\n    if (type === lock_normal) {\r\n      lock_cell(pos, \"normal\", color, text, false);\r\n    } else if (type === lock_color) {\r\n      lock_cell(pos, \"color\", color, text, false);\r\n    } else if (type === lock_boundary) {\r\n      lock_cell(pos, \"boundary\", color, text, bg);\r\n    }\r\n  });\r\n  data.stuff.forEach((_s) => {\r\n    let s = { type: _s[0], style: _s[1], color: _s[2], cells: _s[3] };\r\n    if (s.type === type_path) {\r\n      s.objs = DrawPath(ctx, s.cells, s.style, s.color);\r\n    } else if (s.type === type_cage) {\r\n      s.objs = DrawCage(ctx, s.cells, s.style, s.color);\r\n    }\r\n    stuff.push(s);\r\n  });\r\n}\r\n\r\nfunction load(base64) {\r\n  let pack = Uint8Array.from(atob(base64), (c) => c.charCodeAt(0));\r\n  let unpack = pako.inflate(pack);\r\n  let data = msgpack.decode(unpack);\r\n\r\n  unserialize(data);\r\n}\r\n\r\nexport function DrawGetMetaData(base64) {\r\n  let pack = Uint8Array.from(atob(base64), (c) => c.charCodeAt(0));\r\n  let unpack = pako.inflate(pack);\r\n  let data = msgpack.decode(unpack);\r\n\r\n  return data.desc;\r\n}\r\n\r\nfunction serialize(meta) {\r\n  let out = {\r\n    version: 1,\r\n    grid: [\r\n      cell_size,\r\n      grid_w,\r\n      grid_h,\r\n      grid_left,\r\n      grid_right,\r\n      grid_top,\r\n      grid_bottom,\r\n      grid_div_width,\r\n      grid_div_height,\r\n      grid_style,\r\n      grid_left_diagonal,\r\n      grid_right_diagonal,\r\n    ],\r\n    cells: [],\r\n    stuff: stuff.map((e) => [e.type, e.style, e.color, e.cells]),\r\n    edges: edges,\r\n    desc: meta,\r\n  };\r\n\r\n  each_cell((m) => {\r\n    let pos = [m.x, m.y];\r\n    if (m.lock_type === lock_normal) {\r\n      if (m.normal.text.text() !== \"\")\r\n        out.cells.push([pos, m.lock_type, m.normal.text.text(), m.color]);\r\n      if (m.symcont.symboltext !== \"\" && m.symcont.symboltext !== undefined)\r\n        out.cells.push([\r\n          pos,\r\n          m.lock_type,\r\n          m.symcont.symboltext,\r\n          m.symcont.symbolcolor,\r\n          m.symcont.symbolbg\r\n        ]);\r\n    }\r\n    if (m.fill >= 0) {\r\n      out.cells.push([pos, lock_color, null, m.fill]);\r\n    }\r\n    m.boundary.forEach((b, i) => {\r\n      if (b.symboltext)\r\n        out.cells.push([\r\n          [m.x, m.y, i],\r\n          lock_boundary,\r\n          b.symboltext,\r\n          b.symbolcolor,\r\n          b.symbolbg,\r\n        ]);\r\n        if (b.text.text())\r\n          out.cells.push([\r\n            [m.x, m.y, i],\r\n            lock_boundary,\r\n            b.text.text(),\r\n            b.text.obj.fill(),\r\n          ]);\r\n    });\r\n  });\r\n\r\n  console.log(out);\r\n  return out;\r\n}\r\n\r\nexport function DrawGenerateUrl(meta) {\r\n  let out = serialize(meta);\r\n  let coded = msgpack.encode(out);\r\n  let packed = pako.deflate(coded);\r\n  let base64 = btoa(String.fromCharCode(...packed));\r\n  return window.location.origin + \"/?s=1&p=\" + encodeURIComponent(base64);\r\n}\r\n\r\nexport function DrawCheck() {\r\n  if (main_w !== 9 || main_h !== 9) return [false, \"Not sudoku\"];\r\n  let r = range(1, 10);\r\n  let rows = Array.from({ length: 9 }, () => []);\r\n  let columns = Array.from({ length: 9 }, () => []);\r\n  let boxes = Array.from({ length: 9 }, () => []);\r\n  let missing = null;\r\n  each_cell((m) => {\r\n    let x = m.x - grid_left;\r\n    let y = m.y - grid_top;\r\n    let n = +m.normal.text.text();\r\n    if (x < 0 || y < 0) return;\r\n    if (n === 0 && missing === null) {\r\n      missing = `Missing entry at ${x + 1}, ${y + 1}`;\r\n    }\r\n    columns[x].push(n);\r\n    rows[y].push(n);\r\n    let b = Math.floor(x / 3) + Math.floor(y / 3) * 3;\r\n    boxes[b].push(n);\r\n  });\r\n  if (missing) {\r\n    return [false, missing];\r\n  }\r\n  for (let i = 0; i < 9; ++i) {\r\n    if (!isEqual(rows[i].sort(), r)) {\r\n      return [false, `Bad row ${i + 1}`];\r\n    }\r\n    if (!isEqual(columns[i].sort(), r)) {\r\n      return [false, `Bad column ${i + 1}`];\r\n    }\r\n    if (!isEqual(boxes[i].sort(), r)) {\r\n      return [false, `Bad box ${i + 1}`];\r\n    }\r\n  }\r\n  return [true, \"OK\"];\r\n}\r\n\r\nexport function DrawDelete() {\r\n  if (!solve_mode && cursor) {\r\n    let i = findLastIndex(stuff, (s) =>\r\n      s.cells.find((c) => c[0] === cursor[0] && c[1] === cursor[1])\r\n    );\r\n    if (i === -1) {\r\n      each_mark((m) => {\r\n        if (i !== -1) return;\r\n        i = findLastIndex(stuff, (s) =>\r\n          s.cells.find((c) => c[0] === m.x && c[1] === m.y)\r\n        );\r\n      });\r\n    }\r\n    if (i !== -1) {\r\n      stuff[i].objs.forEach((o) => o.destroy());\r\n      stuff.splice(i, 1);\r\n      scene.draw();\r\n      return;\r\n    }\r\n  }\r\n\r\n  saveUndo();\r\n\r\n  if (boundary) {\r\n    setCell(boundary, \"boundary\", null, \"\", false);\r\n  } else {\r\n    each_mark((m) => {\r\n      setCell([m.x, m.y], \"reset\", null, \"\", false);\r\n    });\r\n  }\r\n\r\n  scene.draw();\r\n}\r\n\r\nexport function DrawReset() {\r\n  each_cell((m) => {\r\n    setCell([m.x, m.y], \"reset\", null, \"\", false);\r\n  });\r\n\r\n  if (!solve_mode) {\r\n    stuff.forEach((s) => s.objs.forEach((o) => o.destroy()));\r\n    stuff = [];\r\n  }\r\n\r\n  undo_stack = [];\r\n  redo_stack = [];\r\n\r\n  scene.draw();\r\n}\r\n\r\nexport function DrawUndo() {\r\n  if (undo_stack.length === 0) return;\r\n  let state = saveState();\r\n  redo_stack.push(state);\r\n  state = undo_stack.pop();\r\n  loadState(state);\r\n  scene.draw();\r\n}\r\n\r\nexport function DrawRedo() {\r\n  if (redo_stack.length === 0) return;\r\n  let state = saveState();\r\n  undo_stack.push(state);\r\n  state = redo_stack.pop();\r\n  loadState(state);\r\n  scene.draw();\r\n}\r\n\r\nfunction addGrid(layer) {\r\n  let dash = grid_style === \"dash\" ? [4] : null;\r\n  let dots = grid_style === \"dots\";\r\n\r\n  let thin = {\r\n    stroke: \"black\",\r\n    strokeWidth: cell_size * thin_grid_line,\r\n    dash: dash,\r\n  };\r\n  let fat = {\r\n    stroke: \"black\",\r\n    strokeWidth: cell_size * medium_grid_line,\r\n  };\r\n\r\n  grid_lines.forEach((g) => g.destroy());\r\n\r\n  main_w = grid_w - grid_left - grid_right;\r\n  main_h = grid_h - grid_top - grid_bottom;\r\n\r\n  grid_lines = [];\r\n  if (grid_left_diagonal || grid_right_diagonal) {\r\n    let diagonal = {\r\n      stroke: DrawColors[1],\r\n      strokeWidth: cell_size * medium_grid_line,\r\n    };\r\n    if (grid_left_diagonal)\r\n      grid_lines.push(\r\n        new Line({\r\n          points: [\r\n            grid_left * cell_size,\r\n            grid_top * cell_size,\r\n            (grid_left + main_w) * cell_size,\r\n            (grid_top + main_h) * cell_size,\r\n          ],\r\n          ...diagonal,\r\n        })\r\n      );\r\n    if (grid_right_diagonal)\r\n      grid_lines.push(\r\n        new Line({\r\n          points: [\r\n            (grid_w - grid_right) * cell_size,\r\n            grid_top * cell_size,\r\n            grid_left * cell_size,\r\n            (grid_top + main_h) * cell_size,\r\n          ],\r\n          ...diagonal,\r\n        })\r\n      );\r\n  }\r\n\r\n  if (dots) {\r\n    let dsize = cell_size * 0.07;\r\n    for (let y = 0; y <= main_h; ++y) {\r\n      for (let x = 0; x <= main_w; ++x) {\r\n        grid_lines.push(\r\n          new Circle({\r\n            x: (grid_left + x) * cell_size,\r\n            y: (grid_top + y) * cell_size,\r\n            radius: dsize,\r\n            fill: \"black\",\r\n          })\r\n        );\r\n      }\r\n    }\r\n  } else {\r\n    for (let x = 0; x <= main_w; ++x) {\r\n      grid_lines.push(\r\n        new Line({\r\n          x: (grid_left + x) * cell_size,\r\n          y: grid_top * cell_size,\r\n          points: [0, 0, 0, main_h * cell_size],\r\n          ...(x % grid_div_width === 0 ? fat : thin),\r\n        })\r\n      );\r\n    }\r\n    for (let y = 0; y <= main_h; ++y) {\r\n      grid_lines.push(\r\n        new Line({\r\n          x: grid_left * cell_size,\r\n          y: (grid_top + y) * cell_size,\r\n          points: [0, 0, main_w * cell_size, 0],\r\n          ...(y % grid_div_height === 0 ? fat : thin),\r\n        })\r\n      );\r\n    }\r\n\r\n    grid_lines.push(\r\n      new Rect({\r\n        x: grid_left * cell_size,\r\n        y: grid_top * cell_size,\r\n        width: main_w * cell_size,\r\n        height: main_h * cell_size,\r\n        stroke: \"black\",\r\n        strokeWidth: cell_size * medium_grid_line,\r\n        fillEnabled: false,\r\n      })\r\n    );\r\n  }\r\n\r\n  layer.add(...grid_lines);\r\n}\r\n\r\nfunction addBoundaries(x, y, boundary) {\r\n  const bc = cell_size * 0.04;\r\n  const cs = cell_size;\r\n  const bsize = cell_size * 0.4;\r\n\r\n  const addBoundary = (x, y, size, type, type2) => {\r\n    let b = new Group({ x: x, y: y });\r\n    let w = size;\r\n    let h = size;\r\n    let s = size;\r\n    if (Array.isArray(size)) {\r\n      w = size[0];\r\n      h = size[1];\r\n      s = Math.min(size[0], size[1]);\r\n    }\r\n    b.rect = null;\r\n    b.bindex = boundary.length;\r\n    b.bsize = s;\r\n    b.bwidth = w;\r\n    b.bheight = h;\r\n    b.btype = type;\r\n    b.btype2 = type2;\r\n\r\n    b.textcont = new Group({x: x, y: y});\r\n    b.text = new TextHolder(b.textcont, \"black\", s * 0.7, s);\r\n    boundary.push(b);\r\n  };\r\n\r\n  // Corners\r\n  addBoundary(bc, bc, bsize, b_corner);\r\n  addBoundary(cs - bsize - bc, bc, bsize, b_corner);\r\n  addBoundary(bc, cs - bsize - bc, bsize, b_corner);\r\n  addBoundary(cs - bsize - bc, cs - bsize - bc, bsize, b_corner);\r\n\r\n  // Sides\r\n  addBoundary(bc, cs / 2 - bsize / 2, bsize, b_side);\r\n  addBoundary(cs / 2 - bsize / 2, bc, bsize, b_side);\r\n  addBoundary(cs - bsize - bc, cs / 2 - bsize / 2, bsize, b_side);\r\n  addBoundary(cs / 2 - bsize / 2, cs - bsize - bc, bsize, b_side);\r\n\r\n  // Quarter\r\n  const qsize = cell_size * 0.4;\r\n  const qc = cell_size * 0.05;\r\n  addBoundary(qc, qc, qsize, b_quarter);\r\n  addBoundary(cs - qsize - qc, qc, qsize, b_quarter);\r\n  addBoundary(qc, cs - qsize - qc, qsize, b_quarter);\r\n  addBoundary(cs - qsize - qc, cs - qsize - qc, qsize, b_quarter);\r\n\r\n  // Edges\r\n  const ew = cell_size * 0.3;\r\n  const eh = cell_size * 0.7;\r\n  const eo = ew / 2;\r\n  addBoundary(-eo, eo, [ew, eh], b_edge, b_left);\r\n  addBoundary(eo, -eo, [eh, ew], b_edge, b_top);\r\n  if (x === grid_w - grid_right - 1)\r\n    addBoundary(cs - eo, eo, [ew, eh], b_edge, b_right);\r\n  if (y === grid_h - grid_bottom - 1)\r\n    addBoundary(eo, cs - eo, [eh, ew], b_edge, b_bottom);\r\n\r\n  // Boundaries\r\n  addBoundary(-bsize / 2, -bsize / 2, bsize, b_boundary);\r\n  addBoundary(-bsize / 2, cs / 2 - bsize / 2, bsize, b_boundary);\r\n  addBoundary(cs / 2 - bsize / 2, -bsize / 2, bsize, b_boundary);\r\n  if (x === grid_w - grid_right - 1) {\r\n    addBoundary(cs - bsize / 2, -bsize / 2, bsize, b_boundary);\r\n    addBoundary(cs - bsize / 2, cs / 2 - bsize / 2, bsize, b_boundary);\r\n  }\r\n  if (y === grid_h - grid_bottom - 1) {\r\n    addBoundary(-bsize / 2, cs - bsize / 2, bsize, b_boundary);\r\n    addBoundary(cs / 2 - bsize / 2, cs - bsize / 2, bsize, b_boundary);\r\n    addBoundary(cs - bsize / 2, cs - bsize / 2, bsize, b_boundary);\r\n  }\r\n\r\n  const bsize2 = cs * 0.8;\r\n  addBoundary(-bsize2 / 2, -bsize2 / 2, bsize2, b_bigboundary);\r\n  addBoundary(-bsize2 / 2, cs / 2 - bsize2 / 2, bsize2, b_bigboundary);\r\n  addBoundary(cs / 2 - bsize2 / 2, -bsize2 / 2, bsize2, b_bigboundary);\r\n  if (x === grid_w - grid_right - 1) {\r\n    addBoundary(cs - bsize2 / 2, -bsize2 / 2, bsize2, b_bigboundary);\r\n    addBoundary(cs - bsize2 / 2, cs / 2 - bsize2 / 2, bsize2, b_bigboundary);\r\n  }\r\n  if (y === grid_h - grid_bottom - 1) {\r\n    addBoundary(-bsize / 2, cs - bsize / 2, bsize, b_bigboundary);\r\n    addBoundary(cs / 2 - bsize / 2, cs - bsize / 2, bsize, b_bigboundary);\r\n    addBoundary(cs - bsize / 2, cs - bsize / 2, bsize, b_bigboundary);\r\n  }\r\n}\r\n\r\nfunction render(wrapper) {\r\n  hover_offset = cell_size * 0.2;\r\n\r\n  const margin = cell_size * 0.2;\r\n  const stage_w = grid_w * cell_size + margin * 2;\r\n  const stage_h = grid_h * cell_size + margin * 2;\r\n  let stage = new Stage({\r\n    container: wrapper,\r\n    width: stage_w,\r\n    height: stage_h,\r\n  });\r\n  scene = new Layer();\r\n  stage.add(scene);\r\n\r\n  reset();\r\n\r\n  outer = new Group({ x: margin, y: margin });\r\n  scene.add(outer);\r\n\r\n  underlay = new Group();\r\n  let underlay2 = new Group();\r\n  let gridlayer = new Group();\r\n  let overlay = new Group();\r\n  outer.add(underlay2, underlay, gridlayer, overlay);\r\n\r\n  for (let y = 0; y < grid_h; ++y) {\r\n    matrix[y] = [];\r\n  }\r\n  let cs = cell_size;\r\n\r\n  for (let x = 0; x < grid_w; ++x) {\r\n    for (let y = 0; y < grid_h; ++y) {\r\n      let xp = x * cs;\r\n      let yp = y * cs;\r\n      let main_grid =\r\n        x >= grid_left &&\r\n        y >= grid_top &&\r\n        x < grid_w - grid_right &&\r\n        y < grid_h - grid_bottom;\r\n      let ocont = new Group({ x: xp, y: yp });\r\n      let cont = new Group({ x: xp, y: yp });\r\n      let symcont = new Group();\r\n      let r = new Rect({\r\n        width: cs,\r\n        height: cs,\r\n        strokeWidth: 0,\r\n        fillEnabled: true,\r\n      });\r\n      let r_color = new Group();\r\n      r_color.rect = new RectHolder(r_color, cs, cs);\r\n      let r_color_set = new Group();\r\n      r_color_set.rect = new RectHolder(r_color_set, cs, cs);\r\n      let r_inner = new Rect({\r\n        x: hover_offset,\r\n        y: hover_offset,\r\n        width: cs - hover_offset * 2,\r\n        height: cs - hover_offset * 2,\r\n        fillEnabled: true,\r\n      });\r\n      let normal = new Group();\r\n      normal.text = new TextHolder(normal, sol_text_color, cs * 0.7, cs);\r\n      let center = new Group();\r\n      center.text = new TextHolder(center, sol_text_color, cs * 0.3, cs);\r\n      let corner_pos = [];\r\n      let corner_size = cell_size * 0.25;\r\n      let co = cell_size * 0.03;\r\n      corner_pos[0] = [co, co];\r\n      corner_pos[1] = [cs - corner_size - co, co];\r\n      corner_pos[2] = [cs - corner_size - co, cs - corner_size - co];\r\n      corner_pos[3] = [co, cs - corner_size - co];\r\n      corner_pos[4] = [(cs - corner_size) / 2, co];\r\n      corner_pos[5] = [cs - corner_size - co, (cs - corner_size) / 2];\r\n      corner_pos[6] = [(cs - corner_size) / 2, cs - corner_size - co];\r\n      corner_pos[7] = [co, (cs - corner_size) / 2];\r\n\r\n      let corner = [];\r\n      let boundary = [];\r\n      if (main_grid) {\r\n        corner_pos.forEach((p, i) => {\r\n          let g = new Group({ x: p[0], y: p[1] });\r\n          g.text = new TextHolder(g, sol_text_color, corner_size, corner_size);\r\n          corner.push(g);\r\n        });\r\n      }\r\n      addBoundaries(x, y, boundary);\r\n\r\n      cont.add(r_color_set, r_color, r, r_inner, symcont, normal, center);\r\n      cont.on(\"mousedown touchstart tap\", (event) => mousedown(event, x, y));\r\n      cont.on(\"mousemove touchmove\", (event) => mousemove(event, x, y));\r\n      r_inner.on(\"mousemove touchmove\", (event) =>\r\n        inner_mousemove(event, x, y)\r\n      );\r\n      matrix[y][x] = {\r\n        x: x,\r\n        y: y,\r\n        pos: [xp, yp],\r\n        symcont: symcont,\r\n        cont: cont,\r\n        ocont: ocont,\r\n        rect: r,\r\n        boundary: boundary,\r\n        fill: -1,\r\n        color: null,\r\n        normal: normal,\r\n        center: center,\r\n        corner: corner,\r\n        corner_pos: corner_pos,\r\n        r_color_set: r_color_set,\r\n        r_color: r_color,\r\n        main_grid: main_grid,\r\n      };\r\n      underlay.add(cont);\r\n      if (main_grid) ocont.add(...corner);\r\n      ocont.add(...boundary);\r\n      ocont.add(...boundary.map(b => b.textcont));\r\n      overlay.add(ocont);\r\n    }\r\n  }\r\n\r\n  addGrid(gridlayer);\r\n\r\n  ctx.scene = scene;\r\n  ctx.underlay = underlay;\r\n  ctx.underlay2 = underlay2;\r\n  ctx.overlay = overlay;\r\n  ctx.cell_size = cell_size;\r\n  ctx.each_cell = each_cell;\r\n  ctx.getLineWidth = getLineWidth;\r\n  ctx.get = get;\r\n  ctx.radius = radius;\r\n}\r\n\r\nexport function DrawUpdateGrid(wrapper, state) {\r\n  let s = serialize();\r\n  if (\"cellSize\" in state) cell_size = state.cellSize;\r\n  if (\"gridDivWidth\" in state) grid_div_width = state.gridDivWidth;\r\n  if (\"gridDivHeight\" in state) grid_div_height = state.gridDivHeight;\r\n  if (\"gridStyle\" in state) grid_style = state.gridStyle;\r\n  if (\"gridLeftDiagonal\" in state) grid_left_diagonal = state.gridLeftDiagonal;\r\n  if (\"gridRightDiagonal\" in state)\r\n    grid_right_diagonal = state.gridRightDiagonal;\r\n  render(wrapper);\r\n  unserialize(s);\r\n  scene.draw();\r\n}\r\n\r\nexport function DrawRender(code, wrapper, state) {\r\n  solve_mode = state.solveMode;\r\n  cell_size = state.cellSize;\r\n  grid_left = state.left;\r\n  grid_right = state.right;\r\n  grid_top = state.top;\r\n  grid_bottom = state.bottom;\r\n  grid_w = grid_left + state.width + grid_right;\r\n  grid_h = grid_top + state.height + grid_bottom;\r\n  grid_div_width = state.gridDivWidth;\r\n  grid_div_height = state.gridDivHeight;\r\n  grid_style = state.gridStyle;\r\n  grid_left_diagonal = state.gridLeftDiagonal;\r\n  grid_right_diagonal = state.gridRightDiagonal;\r\n\r\n  if (code) load_grid(code);\r\n\r\n  render(wrapper);\r\n\r\n  if (code) load(code);\r\n\r\n  scene.draw();\r\n\r\n  DrawSetMode(state);\r\n}\r\n\r\nwindow.addEventListener(\"keydown\", (event) => keydown(event));\r\nwindow.addEventListener(\"keyup\", (event) => keyup(event));\r\nwindow.addEventListener(\"mousedown\", (event) => window_mousedown(event));\r\nwindow.addEventListener(\"mouseup\", (event) => mouseup(event));\r\nwindow.addEventListener(\"touchend\", (event) => mouseup(event));\r\nwindow.addEventListener(\"contextmenu\", (event) => contextmenu(event));\r\n","import React, { useState, useRef, useEffect } from \"react\";\r\nimport \"./App.css\";\r\nimport {\r\n  DrawRender,\r\n  DrawSymbolElement,\r\n  DrawSetMode,\r\n  DrawUndo,\r\n  DrawRedo,\r\n  DrawDelete,\r\n  DrawGenerateUrl,\r\n  DrawSetNumber,\r\n  DrawSetColor,\r\n  DrawColors,\r\n  DrawGetMetaData,\r\n  DrawReset,\r\n  DrawCheck,\r\n  DrawSetSymbolPage,\r\n  DrawUpdateGrid,\r\n} from \"./draw\";\r\nimport {\r\n  Box,\r\n  Button,\r\n  ButtonGroup,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogContentText,\r\n  DialogActions,\r\n  Slider,\r\n  Typography,\r\n  Select,\r\n  MenuItem,\r\n  FormControl,\r\n  FormGroup,\r\n  FormLabel,\r\n  FormControlLabel,\r\n  InputLabel,\r\n  Grid,\r\n  TextField,\r\n  Switch,\r\n} from \"@material-ui/core\";\r\nimport { ConfirmProvider, useConfirm } from \"material-ui-confirm\";\r\nimport { PlayArrow, Pause, SkipPrevious } from \"@material-ui/icons\";\r\n\r\nconst query = window.location.search;\r\nconst urlParams = new URLSearchParams(query);\r\nconst code = urlParams.get(\"p\");\r\nconst solveMode = urlParams.get(\"s\") === \"1\";\r\n\r\nfunction ColorGrid(props) {\r\n  return DrawColors.slice(0, props.num).map((color, index) => (\r\n    <Grid key={index} item xs={4}>\r\n      <Button variant=\"outlined\" onClick={() => DrawSetColor(index)}>\r\n        <div\r\n          style={{\r\n            border: \"1px solid black\",\r\n            background: color,\r\n            width: \"30px\",\r\n            height: \"30px\",\r\n          }}\r\n        />\r\n      </Button>\r\n    </Grid>\r\n  ));\r\n}\r\n\r\nfunction Timer(props) {\r\n  const [seconds, setSeconds] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const id = setInterval(() => {\r\n      if (props.active) {\r\n        setSeconds((s) => s + 1);\r\n      }\r\n    }, 1000);\r\n    return () => clearInterval(id);\r\n  }, [props.active]);\r\n\r\n  const restart = () => {\r\n    props.onStop();\r\n    setSeconds(0);\r\n  };\r\n\r\n  return (\r\n    <Box margin=\"20px\" padding=\"10px\" boxShadow={3}>\r\n      <Typography align=\"center\" variant=\"h4\">\r\n        {new Date(seconds * 1000).toISOString().substr(11, 8)}\r\n      </Typography>\r\n      <ButtonGroup fullWidth={true} size=\"large\">\r\n        <Button onClick={props.onStart}>\r\n          <PlayArrow />\r\n        </Button>\r\n        <Button onClick={props.onStop}>\r\n          <Pause />\r\n        </Button>\r\n        <Button onClick={restart}>\r\n          <SkipPrevious />\r\n        </Button>\r\n      </ButtonGroup>\r\n    </Box>\r\n  );\r\n}\r\n\r\nfunction ResetButton() {\r\n  const confirm = useConfirm();\r\n\r\n  const onClick = () => {\r\n    confirm({ description: \"Remove all changes in grid?\" }).then(() => {\r\n      DrawReset();\r\n      this.setState({ timeStatus: true });\r\n    }).catch(() => undefined);\r\n  };\r\n\r\n  return (\r\n    <Button fullWidth={true} variant=\"contained\" size=\"large\" onClick={onClick}>\r\n      Reset\r\n    </Button>\r\n  );\r\n}\r\n\r\nfunction SymbolSelect() {\r\n  let [page, setPage] = useState(\"0\");\r\n  let symbolRef = [];\r\n  symbolRef[0] = useRef(null);\r\n  symbolRef[1] = useRef(null);\r\n  symbolRef[2] = useRef(null);\r\n  symbolRef[3] = useRef(null);\r\n  symbolRef[4] = useRef(null);\r\n  symbolRef[5] = useRef(null);\r\n  symbolRef[6] = useRef(null);\r\n  symbolRef[7] = useRef(null);\r\n  symbolRef[8] = useRef(null);\r\n  symbolRef[9] = useRef(null);\r\n\r\n  const pages = [\r\n    \"Numbers\",\r\n    \"Circles\",\r\n    \"Arrows\",\r\n    \"Arrows 2\",\r\n    \"Misc\",\r\n    \"Squares\",\r\n    \"Lines\",\r\n  ];\r\n  const setSymbolPage = (e) => setPage(e.target.value);\r\n\r\n  useEffect(() => {\r\n    if (+page > 0) {\r\n      for (let i = 0; i < 9; ++i) {\r\n        DrawSymbolElement(symbolRef[i].current, page, i + 1, 30);\r\n      }\r\n    }\r\n    DrawSetSymbolPage(+page);\r\n  });\r\n\r\n  return (\r\n    <Box>\r\n      <FormControl fullWidth={true}>\r\n        <Select fullWidth={true} value={page} onChange={setSymbolPage}>\r\n          {pages.map((p, i) => (\r\n            <MenuItem key={p} value={i}>\r\n              {p}\r\n            </MenuItem>\r\n          ))}\r\n        </Select>\r\n      </FormControl>\r\n      <Grid container>\r\n        {[...Array(9).keys()].map((index) => (\r\n          <Grid key={index} item xs={4}>\r\n            <Button\r\n              variant=\"outlined\"\r\n              onClick={(e) => {\r\n                DrawSetNumber(index + 1);\r\n              }}\r\n            >\r\n              {+page === 0 && (\r\n                <div style={{ fontSize: \"20px\" }}>{index + 1}</div>\r\n              )}\r\n              {+page > 0 && <div ref={symbolRef[index]} />}\r\n            </Button>\r\n          </Grid>\r\n        ))}\r\n      </Grid>\r\n    </Box>\r\n  );\r\n}\r\n\r\nfunction ColorSelect() {\r\n  let [color, setColor] = useState(0);\r\n\r\n  return DrawColors.map((c, index) => (\r\n    <Grid key={index} item xs={4}>\r\n      <Button\r\n        variant={color === index ? \"contained\" : \"outlined\"}\r\n        onClick={() => {\r\n          setColor(index);\r\n          DrawSetColor(index);\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            border: \"1px solid black\",\r\n            background: c,\r\n            width: \"30px\",\r\n            height: \"30px\",\r\n          }}\r\n        />\r\n      </Button>\r\n    </Grid>\r\n  ));\r\n}\r\n\r\nfunction UrlDialog(props) {\r\n  let openInTab = () => {\r\n    props.onClose();\r\n    let w = window.open(props.text, \"_blank\");\r\n    w.focus();\r\n  };\r\n\r\n  return (\r\n    <Dialog open={props.open} onClose={props.onClose}>\r\n      <DialogTitle>URL</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>{props.text}</DialogContentText>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={openInTab}>Open in tab</Button>\r\n        <Button color=\"primary\" onClick={props.onClose}>\r\n          OK\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nclass App extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.canvasRef = React.createRef();\r\n\r\n    this.state = {\r\n      solveMode: solveMode,\r\n      settingsMode: \"size\",\r\n      color: 0,\r\n      description: \"\",\r\n      cellSize: 64,\r\n      width: 9,\r\n      height: 9,\r\n      left: 0,\r\n      right: 0,\r\n      top: 0,\r\n      bottom: 0,\r\n      gridDivWidth: 3,\r\n      gridDivHeight: 3,\r\n      gridStyle: \"lines\",\r\n      gridLeftDiagonal: false,\r\n      gridRightDiagonal: false,\r\n      mode: solveMode ? \"normal\" : \"number\",\r\n      numberStyle: \"normal\",\r\n      multiDigit: false,\r\n      numberBackground: false,\r\n      edgeStyle: \"fat\",\r\n      cageStyle: \"dash\",\r\n      pathStyle: \"arrow\",\r\n      dialogOpen: false,\r\n      dialogText: \"\",\r\n      timeStatus: true,\r\n      symbolPage: \"0\",\r\n      solveSudoku: true,\r\n      solveEdge: false,\r\n      solveCenterLine: false,\r\n    };\r\n  }\r\n\r\n  handleKeyDown = (event) => {\r\n    if (event.target.tagName === \"TEXTAREA\") return;\r\n\r\n    if (solveMode) {\r\n      const cycle_modes = [\"normal\", \"center\", \"corner\", \"color\"];\r\n      let i = \"qwer\".indexOf(event.key);\r\n      if (event.key.length === 1 && i !== -1) this.setMode(cycle_modes[i]);\r\n      else if (event.key === \" \") {\r\n        let i = cycle_modes.indexOf(this.state.mode);\r\n        i = (i + 1) % cycle_modes.length;\r\n        this.setMode(cycle_modes[i]);\r\n      }\r\n    }\r\n  };\r\n\r\n  componentDidMount() {\r\n    let meta = {};\r\n    if (code) {\r\n      meta = DrawGetMetaData(code);\r\n      if (typeof meta !== \"object\") meta = { description: meta };\r\n    }\r\n    this.setState(meta, () => {\r\n      DrawRender(code, this.canvasRef.current, this.state);\r\n    });\r\n\r\n    document.addEventListener(\"keydown\", this.handleKeyDown);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.handleKeyDown);\r\n    clearInterval(this.interval);\r\n  }\r\n\r\n  setMode = (mode) => {\r\n    let b = document.getElementById(\"button\" + mode);\r\n    if (b) b.focus();\r\n    this.setState({ mode: mode }, () => {\r\n      DrawSetMode(this.state);\r\n    });\r\n  };\r\n\r\n  setStyle = (style, value) => {\r\n    this.setState({ [style]: value }, () => DrawSetMode(this.state));\r\n  };\r\n\r\n  generateUrl = () => {\r\n    let meta = {\r\n      description: this.state.description,\r\n      solveSudoku: this.state.solveSudoku,\r\n      solveEdge: this.state.solveEdge,\r\n      solveCenterLine: this.state.solveCenterLine,\r\n    };\r\n    let url = DrawGenerateUrl(meta);\r\n    this.setState({ dialogText: url, dialogOpen: true });\r\n  };\r\n\r\n  numberStyleBox() {\r\n    return (\r\n      <Box margin=\"10px\">\r\n        <FormControl fullWidth={true}>\r\n          <InputLabel shrink id=\"numberstyle-label\">\r\n            Position\r\n          </InputLabel>\r\n          <Select\r\n            labelId=\"numberstyle-label\"\r\n            fullWidth={true}\r\n            value={this.state.numberStyle}\r\n            onChange={(event) =>\r\n              this.setStyle(\"numberStyle\", event.target.value)\r\n            }\r\n          >\r\n            <MenuItem value=\"normal\">Normal</MenuItem>\r\n            <MenuItem value=\"corner\">Corner</MenuItem>\r\n            <MenuItem value=\"side\">Side</MenuItem>\r\n            <MenuItem value=\"quarter\">Quarter</MenuItem>\r\n            <MenuItem value=\"boundary\">Boundary</MenuItem>\r\n            <MenuItem value=\"bigboundary\">Big boundary</MenuItem>\r\n          </Select>\r\n          <FormControlLabel\r\n            control={\r\n              <Switch\r\n                checked={this.state.numberBackground}\r\n                onChange={(e) => {\r\n                  this.setStyle(\"numberBackground\", e.target.checked);\r\n                }}\r\n              />\r\n            }\r\n            label=\"Background\"\r\n          />\r\n          <FormControlLabel\r\n            control={\r\n              <Switch\r\n                checked={this.state.multiDigit}\r\n                onChange={(e) => {\r\n                  this.setStyle(\"multiDigit\", e.target.checked);\r\n                }}\r\n              />\r\n            }\r\n            label=\"Multi digit\"\r\n          />\r\n        </FormControl>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  cageStyleBox() {\r\n    return (\r\n      <Box margin=\"10px\">\r\n        <FormControl fullWidth={true}>\r\n          <InputLabel shrink id=\"cagestyle-label\">\r\n            Style\r\n          </InputLabel>\r\n          <Select\r\n            labelId=\"cagestyle-label\"\r\n            fullWidth={true}\r\n            value={this.state.cageStyle}\r\n            onChange={(event) => this.setStyle(\"cageStyle\", event.target.value)}\r\n          >\r\n            <MenuItem value=\"dash\">Dashed</MenuItem>\r\n            <MenuItem value=\"edge:thin\">Edge thin</MenuItem>\r\n            <MenuItem value=\"edge:medium\">Edge medium </MenuItem>\r\n            <MenuItem value=\"edge:fat\">Edge fat</MenuItem>\r\n          </Select>\r\n        </FormControl>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  edgeStyleBox() {\r\n    return (\r\n      <Box margin=\"10px\">\r\n        <FormControl fullWidth={true}>\r\n          <InputLabel shrink id=\"edgestyle-label\">\r\n            Style\r\n          </InputLabel>\r\n          <Select\r\n            labelId=\"cagestyle-label\"\r\n            fullWidth={true}\r\n            value={this.state.edgeStyle}\r\n            onChange={(event) => this.setStyle(\"edgeStyle\", event.target.value)}\r\n          >\r\n            <MenuItem value=\"thin\">Thin</MenuItem>\r\n            <MenuItem value=\"medium\">Medium</MenuItem>\r\n            <MenuItem value=\"fat\">Fat</MenuItem>\r\n          </Select>\r\n        </FormControl>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  pathStyleBox() {\r\n    return (\r\n      <Box margin=\"10px\">\r\n        <FormControl fullWidth={true}>\r\n          <InputLabel shrink id=\"pathstyle-label\">\r\n            Style\r\n          </InputLabel>\r\n          <Select\r\n            labelId=\"pathstyle-label\"\r\n            fullWidth={true}\r\n            value={this.state.pathStyle}\r\n            onChange={(event) => this.setStyle(\"pathStyle\", event.target.value)}\r\n          >\r\n            <MenuItem value=\"thin\">Line</MenuItem>\r\n            <MenuItem value=\"medium\">Medium line</MenuItem>\r\n            <MenuItem value=\"fat\">Fat Line</MenuItem>\r\n            <MenuItem value=\"thermo\">Thermo</MenuItem>\r\n            <MenuItem value=\"arrow\">Arrow</MenuItem>\r\n            <MenuItem value=\"arrowcircle\">Arrow with circle</MenuItem>\r\n            <MenuItem value=\"roundborder\">Round border</MenuItem>\r\n            <MenuItem value=\"border\">Border</MenuItem>\r\n            <MenuItem value=\"roundfill\">Round fill</MenuItem>\r\n            <MenuItem value=\"squarefill\">Square fill</MenuItem>\r\n            <MenuItem value=\"polygon\">Polygon</MenuItem>\r\n            <MenuItem value=\"polygonfill\">Polygon fill</MenuItem>\r\n          </Select>\r\n        </FormControl>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  timerBox() {\r\n    return (\r\n      <Box minWidth=\"250px\">\r\n        <Timer\r\n          active={this.state.timeStatus}\r\n          onStart={() => this.setState({ timeStatus: true })}\r\n          onStop={() => this.setState({ timeStatus: false })}\r\n        />\r\n        {this.state.description !== \"\" && (\r\n          <Box margin=\"20px\">\r\n            <TextField\r\n              multiline\r\n              variant=\"outlined\"\r\n              InputProps={{ readOnly: true }}\r\n              value={this.state.description}\r\n            />\r\n          </Box>\r\n        )}\r\n        <Box margin=\"20px\">\r\n          <TextField multiline variant=\"outlined\" />\r\n        </Box>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  settingLeftBox() {\r\n    return (\r\n      <Box minWidth=\"250px\">\r\n        <Box margin=\"30px\">\r\n          <Typography>\r\n            Draw\r\n          </Typography>\r\n          <Select\r\n            fullWidth={true}\r\n            value={this.state.mode}\r\n            onChange={(event) => this.setMode(event.target.value)}\r\n          >\r\n            <MenuItem value=\"number\">Symbol</MenuItem>\r\n            <MenuItem value=\"cage\">Cage</MenuItem>\r\n            <MenuItem value=\"path\">Path</MenuItem>\r\n            <MenuItem value=\"color\">Color</MenuItem>\r\n            <MenuItem value=\"edge\">Edge</MenuItem>\r\n          </Select>\r\n          {this.state.mode === \"number\" && this.numberStyleBox()}\r\n          {this.state.mode === \"cage\" && this.cageStyleBox()}\r\n          {this.state.mode === \"path\" && this.pathStyleBox()}\r\n          {this.state.mode === \"edge\" && this.edgeStyleBox()}\r\n        </Box>\r\n        <Box margin=\"30px\">\r\n          <Typography>\r\n            Settings\r\n          </Typography>\r\n          <Select\r\n            fullWidth={true}\r\n            value={this.state.settingsMode}\r\n            onChange={(event) =>\r\n              this.setState({ settingsMode: event.target.value })\r\n            }\r\n          >\r\n            <MenuItem value=\"size\">Size</MenuItem>\r\n            <MenuItem value=\"margins\">Margins</MenuItem>\r\n            <MenuItem value=\"grid\">Grid</MenuItem>\r\n            <MenuItem value=\"description\">Description</MenuItem>\r\n            <MenuItem value=\"solve\">Solve</MenuItem>\r\n          </Select>\r\n        </Box>\r\n        {this.state.settingsMode === \"size\" && (\r\n          <Box margin=\"30px\" padding=\"10px\" boxShadow={3}>\r\n            {this.sizeSlider(\"cellSize\", \"Cell size\", 32, 96, 4, true)}\r\n            {this.sizeSlider(\"width\", \"Width\", 3, 30)}\r\n            {this.sizeSlider(\"height\", \"Height\", 3, 30)}\r\n          </Box>\r\n        )}\r\n        {this.state.settingsMode === \"margins\" && (\r\n          <Box margin=\"30px\" padding=\"10px\" boxShadow={3}>\r\n            {this.sizeSlider(\"left\", \"Left\")}\r\n            {this.sizeSlider(\"right\", \"Right\")}\r\n            {this.sizeSlider(\"top\", \"Top\")}\r\n            {this.sizeSlider(\"bottom\", \"Bottom\")}\r\n          </Box>\r\n        )}\r\n        {this.state.settingsMode === \"grid\" && (\r\n          <Box margin=\"30px\" padding=\"10px\" boxShadow={3}>\r\n            {this.sizeSlider(\"gridDivWidth\", \"Grid divider width\")}\r\n            {this.sizeSlider(\"gridDivHeight\", \"Grid divider height\")}\r\n            <FormControl fullWidth={true}>\r\n              <InputLabel id=\"gridstyle-label\">Style</InputLabel>\r\n              <Select\r\n                labelId=\"gridstyle-label\"\r\n                fullWidth={true}\r\n                value={this.state.gridStyle}\r\n                onChange={(event) =>\r\n                  this.setGridState(\"gridStyle\", event.target.value)\r\n                }\r\n              >\r\n                <MenuItem value=\"lines\">Lines</MenuItem>\r\n                <MenuItem value=\"dash\">Dashed</MenuItem>\r\n                <MenuItem value=\"dots\">Dots</MenuItem>\r\n              </Select>\r\n            </FormControl>\r\n            <FormControl fullWidth={true}>\r\n              <FormLabel>Diagonals</FormLabel>\r\n              <FormGroup>\r\n                <FormControlLabel\r\n                  fullWidth={true}\r\n                  control={\r\n                    <Switch\r\n                      checked={this.state.gridLeftDiagonal}\r\n                      onChange={(e) => {\r\n                        this.setGridState(\"gridLeftDiagonal\", e.target.checked);\r\n                      }}\r\n                    />\r\n                  }\r\n                  label=\"Left\"\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      labelId=\"rightdiagonal-label\"\r\n                      fullWidth={true}\r\n                      checked={this.state.gridRightDiagonal}\r\n                      onChange={(e) => {\r\n                        this.setGridState(\r\n                          \"gridRightDiagonal\",\r\n                          e.target.checked\r\n                        );\r\n                      }}\r\n                    />\r\n                  }\r\n                  label=\"Right\"\r\n                />\r\n              </FormGroup>\r\n            </FormControl>\r\n          </Box>\r\n        )}\r\n        {this.state.settingsMode === \"description\" && (\r\n          <Box margin=\"30px\" padding=\"10px\" boxShadow={3}>\r\n            <TextField\r\n              multiline\r\n              rows={8}\r\n              value={this.state.description}\r\n              onChange={(e) => this.setState({ description: e.target.value })}\r\n            />\r\n          </Box>\r\n        )}\r\n        {this.state.settingsMode === \"solve\" && (\r\n          <Box margin=\"30px\" padding=\"10px\" boxShadow={3}>\r\n            <FormControl fullWidth={true}>\r\n              <FormLabel></FormLabel>\r\n              <FormGroup>\r\n                <FormControlLabel\r\n                  fullWidth={true}\r\n                  control={\r\n                    <Switch\r\n                      checked={this.state.solveSudoku}\r\n                      onChange={(e) => {\r\n                        this.setState({ solveSudoku: e.target.checked });\r\n                      }}\r\n                    />\r\n                  }\r\n                  label=\"Sudoku\"\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      fullWidth={true}\r\n                      checked={this.state.solveEdge}\r\n                      onChange={(e) => {\r\n                        this.setState({ solveEdge: e.target.checked });\r\n                      }}\r\n                    />\r\n                  }\r\n                  label=\"Edge\"\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      fullWidth={true}\r\n                      checked={this.state.solveCenterLine}\r\n                      onChange={(e) => {\r\n                        this.setState({ solveCenterLine: e.target.checked });\r\n                      }}\r\n                    />\r\n                  }\r\n                  label=\"Center line\"\r\n                />\r\n              </FormGroup>\r\n            </FormControl>\r\n          </Box>\r\n        )}\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  handleChange(newValue, type) {\r\n    this.setState({ [type]: newValue });\r\n  }\r\n\r\n  setGrid(type) {\r\n    if (\r\n      [\r\n        \"cellSize\",\r\n        \"gridDivWidth\",\r\n        \"gridDivHeight\",\r\n        \"gridStyle\",\r\n        \"gridLeftDiagonal\",\r\n        \"gridRightDiagonal\",\r\n      ].includes(type)\r\n    )\r\n      DrawUpdateGrid(this.canvasRef.current, this.state);\r\n    else DrawRender(code, this.canvasRef.current, this.state);\r\n  }\r\n\r\n  setGridState = (state, value) => {\r\n    this.setState({ [state]: value }, () => {\r\n      this.setGrid(state);\r\n    });\r\n  };\r\n\r\n  sizeSlider(type, label, min = 0, max = 10, step = 1, marks = false) {\r\n    return (\r\n      <Box>\r\n        <Typography>\r\n          {label}: {this.state[type]}\r\n        </Typography>\r\n        <Slider\r\n          value={this.state[type]}\r\n          min={min}\r\n          max={max}\r\n          step={step}\r\n          marks={marks}\r\n          id={type}\r\n          onChange={(e, newValue) => this.handleChange(newValue, type)}\r\n          onChangeCommitted={() => this.setGrid(type)}\r\n        />\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  check = () => {\r\n    let r = DrawCheck();\r\n    let status = r[0];\r\n    let msg = r[1];\r\n    if (status) this.setState({ timeStatus: false });\r\n    alert(msg);\r\n  };\r\n\r\n  renderSolveMode() {\r\n    let buttons = [];\r\n    if (this.state.solveSudoku)\r\n      buttons.push(\r\n        [\"normal\", \"Normal\"],\r\n        [\"center\", \"Center\"],\r\n        [\"corner\", \"Corner\"]\r\n      );\r\n    if (this.state.solveEdge) buttons.push([\"edgecross\", \"Edge\"]);\r\n    if (this.state.solveCenterLine) buttons.push([\"centerline\", \"Center line\"]);\r\n    buttons.push([\"color\", \"Color\"]);\r\n\r\n    return (\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        {this.timerBox()}\r\n        <Box display=\"flex\">\r\n          <div id=\"canvas\" ref={this.canvasRef}></div>\r\n        </Box>\r\n        <Box minWidth=\"250px\" maxWidth=\"250px\">\r\n          <Box margin=\"30px\">\r\n            <ButtonGroup\r\n              fullWidth={true}\r\n              size=\"large\"\r\n              variant=\"contained\"\r\n              orientation=\"vertical\"\r\n            >\r\n              {buttons.map((b) => (\r\n                <Button\r\n                  id={\"button\" + b[0]}\r\n                  key={b[0]}\r\n                  color={this.state.mode === b[0] ? \"primary\" : \"default\"}\r\n                  onClick={() => this.setMode(b[0])}\r\n                >\r\n                  {b[1]}\r\n                </Button>\r\n              ))}\r\n            </ButtonGroup>\r\n          </Box>\r\n          <Box margin=\"30px\">\r\n            <ButtonGroup\r\n              fullWidth={true}\r\n              size=\"large\"\r\n              variant=\"contained\"\r\n              orientation=\"vertical\"\r\n            >\r\n              <Button onClick={DrawUndo}>Undo</Button>\r\n              <Button onClick={DrawRedo}>Redo</Button>\r\n              <Button onClick={DrawDelete}>Delete</Button>\r\n            </ButtonGroup>\r\n          </Box>\r\n          <Box margin=\"30px\">\r\n            <ButtonGroup\r\n              fullWidth={true}\r\n              size=\"large\"\r\n              variant=\"contained\"\r\n              orientation=\"vertical\"\r\n            >\r\n              <Button onClick={this.check}>Check</Button>\r\n              <ResetButton />\r\n            </ButtonGroup>\r\n          </Box>\r\n          <Box margin=\"30px\">\r\n            <Grid container>\r\n              {this.state.mode === \"color\" && <ColorGrid num={9} />}\r\n              {[\"normal\", \"center\", \"corner\"].includes(this.state.mode) &&\r\n                [...Array(9).keys()].map((index) => (\r\n                  <Grid key={index} item xs={4}>\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      onClick={() => DrawSetNumber(index + 1)}\r\n                    >\r\n                      <div style={{ fontSize: \"20px\" }}>{index + 1}</div>\r\n                    </Button>\r\n                  </Grid>\r\n                ))}\r\n            </Grid>\r\n          </Box>\r\n        </Box>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  settingRight() {\r\n    return (\r\n      <Grid container>\r\n        {this.state.mode !== \"color\" && <ColorSelect />}\r\n        {this.state.mode === \"color\" && <ColorGrid />}\r\n        {this.state.mode === \"number\" && <SymbolSelect />}\r\n      </Grid>\r\n    );\r\n  }\r\n\r\n  renderSetMode() {\r\n    return (\r\n      <Box display=\"flex\" flexDirection=\"row\">\r\n        <UrlDialog\r\n          text={this.state.dialogText}\r\n          open={this.state.dialogOpen}\r\n          onClose={() => this.setState({ dialogOpen: false })}\r\n        />\r\n        {this.settingLeftBox()}\r\n        <Box display=\"flex\">\r\n          <div id=\"canvas\" ref={this.canvasRef}></div>\r\n        </Box>\r\n        <Box minWidth=\"250px\" maxWidth=\"250px\">\r\n          <Box margin=\"30px\">\r\n            <ButtonGroup\r\n              fullWidth={true}\r\n              size=\"large\"\r\n              variant=\"contained\"\r\n              orientation=\"vertical\"\r\n            >\r\n              <Button onClick={DrawDelete}>Delete</Button>\r\n              <Button onClick={this.generateUrl}>Generate URL</Button>\r\n            </ButtonGroup>\r\n          </Box>\r\n          <Box margin=\"30px\">\r\n            <ButtonGroup\r\n              fullWidth={true}\r\n              size=\"large\"\r\n              variant=\"contained\"\r\n              orientation=\"vertical\"\r\n            >\r\n              <ResetButton />\r\n            </ButtonGroup>\r\n          </Box>\r\n          <Box margin=\"30px\">{this.settingRight()}</Box>\r\n        </Box>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <ConfirmProvider>\r\n        {solveMode ? this.renderSolveMode() : this.renderSetMode()}\r\n      </ConfirmProvider>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}